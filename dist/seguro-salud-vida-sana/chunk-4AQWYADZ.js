import{a as U}from"./chunk-WIG3ZVDE.js";import{a as N}from"./chunk-3GOBKWC2.js";import{a as F}from"./chunk-GB72KSVT.js";import{a as D,b as H}from"./chunk-BNUNU2GP.js";import{B as j,f as y,k as B,l as $,n as k,u as R}from"./chunk-RDO4C5ZH.js";import"./chunk-4YRY4IP2.js";import{j as A}from"./chunk-24563CTF.js";import{a as w}from"./chunk-WURDNOJS.js";import{h as E,j as O,o as T}from"./chunk-EALBQTKK.js";import{q as I}from"./chunk-5DWL5JJZ.js";import{$a as h,Ab as r,Bb as d,Ib as M,Jb as P,Na as l,Oa as c,_ as f,cb as C,ha as b,hb as i,ia as v,ib as o,nb as S,qb as x,rb as _}from"./chunk-3RWLLOHT.js";var G=()=>({"min-width":"50rem","max-width":"100%"});function L(s,e){s&1&&(i(0,"tr")(1,"th",4),r(2,"ID Consulta"),o(),i(3,"th",5),r(4,"Fecha Consulta"),o(),i(5,"th",6),r(6,"Motivo Consulta"),o(),i(7,"th",5),r(8,"Diagn\xF3stico"),o(),i(9,"th",5),r(10,"Nota"),o(),i(11,"th",7),r(12,"Acciones"),o()())}function K(s,e){if(s&1){let t=S();i(0,"tr")(1,"td"),r(2),o(),i(3,"td"),r(4),o(),i(5,"td"),r(6),o(),i(7,"td"),r(8),o(),i(9,"td"),r(10),o(),i(11,"td")(12,"button",8),x("click",function(){let m=b(t).$implicit,a=_();return v(a.irATratamiento(m.id))}),o()()()}if(s&2){let t=e.$implicit;l(2),d(t.id),l(2),d(t.fechaConsulta),l(2),d(t.motivoConsulta),l(2),d(t.diagnostico),l(2),d(t.nota)}}var p=class s{constructor(e,t,n,m,a,u,g){this.router=e;this.route=t;this.aseguradoService=n;this.consultaService=m;this.tratamientoService=a;this.bitacoraService=u;this.authService=g}asegurado=null;consultas=[];ngOnInit(){this.route.paramMap.subscribe(e=>{let t=Number(e.get("aseguradoId"));t&&this.obtenerAsegurado(t)})}obtenerAsegurado(e){this.aseguradoService.getAseguradoById(e).subscribe(t=>{this.asegurado=t,t.historiaClinica&&t.historiaClinica.id&&this.obtenerConsultas(t.historiaClinica.id)},t=>{console.error("Error al obtener el asegurado:",t)})}obtenerConsultas(e){this.consultaService.getConsultasPorHistoriaClinicaId(e).subscribe(t=>{this.consultas=t,this.verificarTratamientos()},t=>{console.error("Error al obtener las consultas:",t)})}verificarTratamientos(){this.consultas.forEach(e=>{e.id!==void 0?this.tratamientoService.getTratamientoByConsultaId(e.id).subscribe(t=>{e.tieneTratamiento=!!t},t=>{e.tieneTratamiento=!1}):e.tieneTratamiento=!1})}registrarBitacora(e,t,n){this.bitacoraService.getUserIP().subscribe({next:m=>{let a=new Date,u=`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`,g=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`,V={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:u,hora:g,ip:m.ip,accion:e,detalle:t};this.bitacoraService.createBitacora(V).subscribe({next:()=>{console.log("Registro de bit\xE1cora exitoso"),n()},error:z=>{console.error("Error al registrar en bit\xE1cora",z),n()}})},error:m=>{console.error("Error al obtener IP",m),n()}})}irATratamiento(e){if(this.asegurado){let t=`${this.asegurado.usuario.nombre} ${this.asegurado.usuario.apellido}`,n=`Listar tratamiento de la consulta (${e}) del paciente (${t})`;this.registrarBitacora("Listar tratamiento",n,()=>{this.router.navigate(["/tratamiento",e])})}else console.error("El asegurado no est\xE1 disponible."),this.router.navigate(["/tratamiento",e])}static \u0275fac=function(t){return new(t||s)(c(O),c(E),c(F),c(N),c(U),c(w),c(T))};static \u0275cmp=f({type:s,selectors:[["app-historia-clinica"]],standalone:!0,features:[M],decls:6,vars:3,consts:[[1,"historia-clinica-container"],["dataKey","id",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"width","15%"],[2,"width","20%"],[2,"width","25%"],[2,"width","10%"],["pButton","","type","button","icon","pi pi-arrow-right",1,"p-button-rounded","p-button-text","p-button-info",3,"click"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"h3"),r(2,"Historia Cl\xEDnica de Usuario"),o(),i(3,"p-table",1),h(4,L,13,0,"ng-template",2)(5,K,13,5,"ng-template",3),o()()),t&2&&(l(3),C("value",n.consultas)("tableStyle",P(2,G)))},dependencies:[I,j,R,y,A,k,$,B,H,D],styles:[".historia-clinica-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;padding:1.5rem;background-color:#f9f9f9;border-radius:12px;box-shadow:0 4px 8px #0000001a}.historia-clinica-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1.5rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.p-table[_ngcontent-%COMP%]{width:100%;border-radius:8px;overflow:hidden;font-size:.95rem;box-shadow:0 4px 8px #0000001a}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:12px;text-align:center;font-weight:700}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}.p-button-info[_ngcontent-%COMP%]{background-color:#3f51b5!important;color:#fff!important;width:2.5rem;height:2.5rem;border-radius:50%;transition:background-color .3s ease}.p-button-info[_ngcontent-%COMP%]:hover{background-color:#2c3e9e!important}"]})};export{p as default};
