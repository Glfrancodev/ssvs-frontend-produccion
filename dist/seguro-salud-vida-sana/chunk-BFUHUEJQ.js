import{a as G}from"./chunk-VAO66HGS.js";import{a as z}from"./chunk-GB72KSVT.js";import{a as j,b as D}from"./chunk-BNUNU2GP.js";import{B as V,d as m,f as T,k as R,l as F,n as H,u as N}from"./chunk-RDO4C5ZH.js";import"./chunk-4YRY4IP2.js";import{j as $}from"./chunk-24563CTF.js";import{a as B}from"./chunk-WURDNOJS.js";import{h as A,j as k,o as y}from"./chunk-EALBQTKK.js";import{q as E}from"./chunk-5DWL5JJZ.js";import{$a as _,Ab as r,Bb as d,Db as O,Hb as P,Ib as w,Jb as I,Na as p,Oa as c,_ as S,cb as x,ha as l,hb as o,ia as g,ib as i,nb as M,qb as b,rb as f}from"./chunk-3RWLLOHT.js";var U=()=>({"min-width":"50rem","max-width":"100%"});function K(s,t){s&1&&(o(0,"tr")(1,"th",4),r(2,"N\xFAmero"),i(),o(3,"th",5),r(4,"Fecha Reservado"),i(),o(5,"th",4),r(6,"Hora"),i(),o(7,"th",4),r(8,"Fecha Horario"),i(),o(9,"th",5),r(10,"Nombre Asegurado"),i(),o(11,"th",4),r(12,"Acciones"),i()())}function Y(s,t){if(s&1){let e=M();o(0,"tr")(1,"td"),r(2),i(),o(3,"td"),r(4),i(),o(5,"td"),r(6),i(),o(7,"td"),r(8),i(),o(9,"td"),r(10),i(),o(11,"td")(12,"button",6),b("click",function(){let a=l(e).$implicit,u=f();return g(u.verHistoriaClinica(a.asegurado.id))}),i(),o(13,"button",7),b("click",function(){let a=l(e).$implicit,u=f();return g(u.iniciarConsulta(a.id))}),i()()()}if(s&2){let e=t.$implicit;p(2),d(e.numero),p(2),d(e.fechaReservado),p(2),d(e.hora),p(2),d(e.horario.fecha),p(2),O("",e.asegurado.usuario.nombre," ",e.asegurado.usuario.apellido,"")}}var v=class s{constructor(t,e,n,a,u,h,C){this.route=t;this.cupoService=e;this.router=n;this.bitacoraService=a;this.messageService=u;this.authService=h;this.aseguradoService=C}cupos=[];ngOnInit(){this.route.paramMap.subscribe(t=>{let e=Number(t.get("idHorario"));e&&this.obtenerCuposOcupados(e)})}obtenerCuposOcupados(t){this.cupoService.getCuposOcupadosPorHorario(t).subscribe(e=>{this.cupos=e,console.log("Cupos ocupados:",this.cupos)},e=>{console.error("Error al obtener los cupos ocupados:",e)})}verHistoriaClinica(t){this.aseguradoService.getAseguradoById(t).subscribe(e=>{let n=`${e.usuario.nombre} ${e.usuario.apellido}`;this.registrarBitacora("Listar Historia Clinica",`Listar Historia Clinica de ${n}`),this.router.navigate(["/historia-clinica",t])})}iniciarConsulta(t){this.cupoService.getCupoById(t).subscribe(e=>{let n=`${e.asegurado.usuario.nombre} ${e.asegurado.usuario.apellido}`;this.registrarBitacora("Comienzo de la consulta",`Comienzo de la consulta de ${n}`),this.router.navigate(["/consulta",t])})}registrarBitacora(t,e){this.bitacoraService.getUserIP().subscribe({next:n=>{let a=new Date,u=`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`,h=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`,C={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:u,hora:h,ip:n.ip,accion:t,detalle:e};this.bitacoraService.createBitacora(C).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:L=>console.error("Error al registrar en bit\xE1cora",L)})},error:n=>console.error("Error al obtener IP",n)})}static \u0275fac=function(e){return new(e||s)(c(A),c(G),c(k),c(B),c(m),c(y),c(z))};static \u0275cmp=S({type:s,selectors:[["app-cupo-medico"]],standalone:!0,features:[P([m]),w],decls:6,vars:3,consts:[[1,"cupo-container"],["dataKey","id",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"width","15%"],[2,"width","20%"],["pButton","","type","button","icon","pi pi-ellipsis-h",1,"p-button-rounded","p-button-text","p-button-info",3,"click"],["pButton","","type","button","icon","pi pi-arrow-right",1,"p-button-rounded","p-button-text","p-button-success",3,"click"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"h3"),r(2,"Tus Citas"),i(),o(3,"p-table",1),_(4,K,13,0,"ng-template",2)(5,Y,14,6,"ng-template",3),i()()),e&2&&(p(3),x("value",n.cupos)("tableStyle",I(2,U)))},dependencies:[E,V,N,T,$,H,F,R,D,j],styles:[".cupo-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;padding:1.5rem;background-color:#f9f9f9;border-radius:12px;box-shadow:0 4px 8px #0000001a}.cupo-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1.5rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.p-table[_ngcontent-%COMP%]{width:100%;border-radius:8px;overflow:hidden;font-size:.95rem;box-shadow:0 4px 8px #0000001a}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:12px;text-align:center;font-weight:700}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}.p-button-info[_ngcontent-%COMP%]{background-color:#3f51b5!important;color:#fff!important;width:2.5rem;height:2.5rem;border-radius:50%;transition:background-color .3s ease}.p-button-info[_ngcontent-%COMP%]:hover{background-color:#2c3e9e!important}.p-button-success[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important;width:2.5rem;height:2.5rem;border-radius:50%;transition:background-color .3s ease}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}"]})};export{v as default};
