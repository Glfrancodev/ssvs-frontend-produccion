import{a as Y}from"./chunk-DH36QBQF.js";import{a as J}from"./chunk-ANR2QTJT.js";import{a as q}from"./chunk-BFV4IBRI.js";import{a as $}from"./chunk-L2XWMXCQ.js";import{a as N,b as U}from"./chunk-37FNDG3E.js";import{a as L,b as K}from"./chunk-TH7K6BJO.js";import{B as G,d as k,f as D,k as F,l as j,n as R,t as V,u as z}from"./chunk-LJKAMAZ5.js";import{j as H}from"./chunk-W5NNSEVP.js";import"./chunk-4YRY4IP2.js";import{a as T}from"./chunk-S2R25WKX.js";import{h as A,j as y,o as B}from"./chunk-V6WZIOIM.js";import{r as w}from"./chunk-2HP4KZBQ.js";import{$a as M,Eb as P,Fb as I,Gb as O,Ka as l,La as c,X as b,Ya as S,ea as g,eb as o,fa as v,fb as r,gb as E,kb as _,nb as C,ob as x,xb as a,yb as p}from"./chunk-TOSOZOFE.js";import"./chunk-ODN5LVDJ.js";var Q=()=>({"min-width":"50rem","max-width":"100%"});function W(d,i){d&1&&(o(0,"tr")(1,"th",4),a(2,"Fecha"),r(),o(3,"th",4),a(4,"Hora Inicio"),r(),o(5,"th",4),a(6,"Hora Final"),r(),o(7,"th",4),a(8,"Cupos Totales"),r(),o(9,"th",4),a(10,"Acciones"),r()())}function X(d,i){if(d&1){let e=_();o(0,"tr")(1,"td"),a(2),r(),o(3,"td"),a(4),r(),o(5,"td"),a(6),r(),o(7,"td"),a(8),r(),o(9,"td")(10,"button",5),C("click",function(){let n=g(e).$implicit,s=x();return v(s.irACupoMedico(n.id))}),r()()()}if(d&2){let e=i.$implicit;l(2),p(e.fecha),l(2),p(e.horaInicio),l(2),p(e.horaFinal),l(2),p(e.cantidadCupos)}}var m=class d{constructor(i,e,t,n,s,u,f,h){this.route=i;this.router=e;this.especialidadService=t;this.medicoService=n;this.medicoEspecialidadService=s;this.authService=u;this.horarioService=f;this.bitacoraService=h}especialidadSeleccionada={id:void 0,nombre:"",descripcion:""};medicoEspecialidad=null;horarios=[];ngOnInit(){this.route.paramMap.subscribe(i=>{let e=i.get("especialidad");e&&this.obtenerEspecialidadPorNombre(e)})}obtenerEspecialidadPorNombre(i){this.especialidadService.getEspecialidadByNombre(i).subscribe(e=>{this.especialidadSeleccionada=e,this.obtenerMedico()},e=>{console.error("Error al obtener la especialidad:",e)})}obtenerMedico(){let i=this.authService.getAuthenticatedUserEmail();i&&this.especialidadSeleccionada.id!==void 0?this.medicoService.getMedicoPorCorreo(i).subscribe(e=>{e.id!==void 0&&this.especialidadSeleccionada.id!==void 0?this.obtenerMedicoEspecialidad(e.id,this.especialidadSeleccionada.id):console.error("El ID del m\xE9dico o de la especialidad es undefined.")},e=>{console.error("Error al obtener el m\xE9dico:",e)}):console.error("Correo m\xE9dico o ID de especialidad no disponible.")}obtenerMedicoEspecialidad(i,e){this.medicoEspecialidadService.getMedicoEspecialidadByEspecialidadAndMedico(e,i).subscribe(t=>{this.medicoEspecialidad=t,console.log("MedicoEspecialidad obtenida:",this.medicoEspecialidad),this.medicoEspecialidad&&this.medicoEspecialidad.id!==void 0&&this.obtenerHorariosPorMedicoEspecialidad(this.medicoEspecialidad.id)},t=>{console.error("Error al obtener MedicoEspecialidad:",t)})}obtenerHorariosPorMedicoEspecialidad(i){this.horarioService.getHorariosPorMedicoEspecialidad(i).subscribe(e=>{this.horarios=e,console.log("Horarios obtenidos:",this.horarios)},e=>{console.error("Error al obtener los horarios:",e)})}registrarBitacora(i,e){this.bitacoraService.getUserIP().subscribe({next:t=>{let n=new Date,s=`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`,u=`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}:${n.getSeconds().toString().padStart(2,"0")}`,f={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:s,hora:u,ip:t.ip,accion:i,detalle:e};this.bitacoraService.createBitacora(f).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:h=>console.error("Error al registrar en bit\xE1cora",h)})},error:t=>console.error("Error al obtener IP",t)})}irACupoMedico(i){if(i!==void 0){let e=this.horarios.find(s=>s.id===i),t=this.especialidadSeleccionada.nombre,n=`Listar mis cupos ocupados del (${e?.fecha} de ${e?.horaInicio} a ${e?.horaFinal}) de (${t})`;this.registrarBitacora("Listar cupos ocupados",n),this.router.navigate(["/cupo-medico",i])}else console.error("El ID del horario es undefined.")}static \u0275fac=function(e){return new(e||d)(c(A),c(y),c(Y),c($),c(q),c(B),c(J),c(T))};static \u0275cmp=b({type:d,selectors:[["app-atencion"]],standalone:!0,features:[P([k]),I],decls:7,vars:3,consts:[[1,"horario-container"],["dataKey","id",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"width","20%"],["pButton","","icon","pi pi-arrow-right","title","Ir a Cupo M\xE9dico",1,"p-button-rounded","p-button-info",2,"width","2.5rem","height","2.5rem",3,"click"]],template:function(e,t){e&1&&(E(0,"p-toast"),o(1,"div",0)(2,"h3"),a(3,"Tus Horarios"),r(),o(4,"p-table",1),S(5,W,11,0,"ng-template",2)(6,X,11,4,"ng-template",3),r()()),e&2&&(l(4),M("value",t.horarios)("tableStyle",O(2,Q)))},dependencies:[w,G,z,D,K,L,V,H,R,j,F,U,N],styles:[".horario-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;padding:1.5rem;background-color:#f9f9f9;border-radius:12px;box-shadow:0 4px 8px #0000001a}.horario-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1.5rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.p-table[_ngcontent-%COMP%]{width:100%;border-radius:8px;overflow:hidden;font-size:.95rem;box-shadow:0 4px 8px #0000001a}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:12px;text-align:center;font-weight:700}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}.p-button-info[_ngcontent-%COMP%]{background-color:#3f51b5!important;color:#fff!important;border:none!important}.p-button-info[_ngcontent-%COMP%]:hover{background-color:#2c3e9e!important}"]})};export{m as default};
