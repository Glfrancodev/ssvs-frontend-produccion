import{a as de}from"./chunk-VSSQ573Q.js";import{a as ne,b as oe}from"./chunk-FNNVKIP6.js";import{a as ae,b as re}from"./chunk-ZIVYLMDF.js";import{a as ie}from"./chunk-JQIAP6UG.js";import{A as K,B as Y,C as J,D as Q,E as X,F as Z,G as ee,H as te,d as w,h as G,o as z,p as L,q,r as U,s as H}from"./chunk-F5T2E34X.js";import{o as F,q as N,s as W,t as $,w as A,y as j}from"./chunk-RO5PIZCY.js";import"./chunk-4YRY4IP2.js";import{m as V,r as D}from"./chunk-2HP4KZBQ.js";import{$a as u,Bb as h,Cb as E,Db as C,Eb as I,Fb as R,Gb as T,Ka as p,La as _,X as P,Ya as f,_b as B,ea as s,eb as r,fa as m,fb as d,gb as k,kb as g,nb as b,ob as c,xb as l,yb as O,zb as v}from"./chunk-TOSOZOFE.js";import{a as M}from"./chunk-ODN5LVDJ.js";var le=()=>({"min-width":"50rem"});function pe(n,e){n&1&&(r(0,"tr")(1,"th",11),l(2,"ID"),d(),r(3,"th",12),l(4,"Nombre"),d(),r(5,"th",12),l(6,"Descripci\xF3n"),d(),r(7,"th",13),l(8,"Acci\xF3n"),d()())}function se(n,e){if(n&1){let t=g();r(0,"input",22),C("ngModelChange",function(o){s(t);let a=c().$implicit;return E(a.nombre,o)||(a.nombre=o),m(o)}),d()}if(n&2){let t=c().$implicit;h("ngModel",t.nombre)}}function me(n,e){if(n&1&&l(0),n&2){let t=c().$implicit;v(" ",t.nombre," ")}}function ue(n,e){if(n&1){let t=g();r(0,"input",22),C("ngModelChange",function(o){s(t);let a=c().$implicit;return E(a.descripcion,o)||(a.descripcion=o),m(o)}),d()}if(n&2){let t=c().$implicit;h("ngModel",t.descripcion)}}function ge(n,e){if(n&1&&l(0),n&2){let t=c().$implicit;v(" ",t.descripcion," ")}}function _e(n,e){if(n&1){let t=g();r(0,"button",23),b("click",function(){s(t);let o=c().$implicit,a=c();return m(a.onRowEditInit(o))}),d()}}function be(n,e){if(n&1){let t=g();r(0,"button",24),b("click",function(){s(t);let o=c().$implicit,a=c();return m(a.deleteEspecialidad(o.id))}),d()}}function fe(n,e){if(n&1){let t=g();r(0,"button",25),b("click",function(){s(t);let o=c().$implicit,a=c();return m(a.onRowEditSave(o))}),d()}}function he(n,e){if(n&1){let t=g();r(0,"button",26),b("click",function(){s(t);let o=c(),a=o.$implicit,x=o.rowIndex,S=c();return m(S.onRowEditCancel(a,x))}),d()}}function Ee(n,e){if(n&1&&(r(0,"tr",14)(1,"td"),l(2),d(),r(3,"td")(4,"p-cellEditor"),f(5,se,1,1,"ng-template",15)(6,me,1,1,"ng-template",16),d()(),r(7,"td")(8,"p-cellEditor"),f(9,ue,1,1,"ng-template",15)(10,ge,1,1,"ng-template",16),d()(),r(11,"td")(12,"div",17),f(13,_e,1,0,"button",18)(14,be,1,0,"button",19)(15,fe,1,0,"button",20)(16,he,1,0,"button",21),d()()()),n&2){let t=e.$implicit,i=e.editing;u("pEditableRow",t),p(2),O(t.id),p(11),u("ngIf",!i),p(),u("ngIf",!i),p(),u("ngIf",i),p(),u("ngIf",i)}}var y=class n{constructor(e,t,i,o,a){this.especialidadService=e;this.messageService=t;this.bitacoraService=i;this.cdr=o;this.authService=a}especialidades=[];editedEspecialidades={};newEspecialidad={nombre:"",descripcion:""};sortField="id";sortOrder=1;ngOnInit(){this.getAllEspecialidades()}getAllEspecialidades(){this.especialidadService.getEspecialidades().subscribe(e=>{this.especialidades=e})}onRowEditInit(e){this.editedEspecialidades[e.id]=M({},e),this.messageService.add({severity:"info",summary:"Edici\xF3n",detail:"Editando especialidad"})}onRowEditSave(e){e.nombre&&e.descripcion?this.especialidadService.updateEspecialidad(e).subscribe(()=>{delete this.editedEspecialidades[e.id],this.messageService.add({severity:"success",summary:"Guardado",detail:"Especialidad actualizada"}),this.registrarBitacora("Editar especialidad",`Especialidad editada: ${e.nombre}`)}):this.messageService.add({severity:"error",summary:"Error",detail:"Nombre y descripci\xF3n son obligatorios"})}onRowEditCancel(e,t){this.especialidades[t]=this.editedEspecialidades[e.id]||e,delete this.editedEspecialidades[e.id],this.messageService.add({severity:"info",summary:"Cancelado",detail:"Edici\xF3n cancelada"})}deleteEspecialidad(e){let t=this.especialidades.find(i=>i.id===e);this.especialidadService.deleteEspecialidad(e).subscribe(()=>{this.especialidades=this.especialidades.filter(i=>i.id!==e),this.messageService.add({severity:"success",summary:"Eliminado",detail:"Especialidad eliminada correctamente"}),t&&this.registrarBitacora("Eliminar especialidad",`Especialidad eliminada: ${t.nombre}`)})}saveEspecialidad(){this.newEspecialidad.nombre&&this.newEspecialidad.descripcion?this.especialidadService.createEspecialidad(this.newEspecialidad).subscribe(e=>{this.especialidades=[...this.especialidades,e],this.cdr.detectChanges(),this.messageService.add({severity:"success",summary:"Guardado",detail:"Nueva especialidad creada correctamente"}),this.registrarBitacora("A\xF1adir especialidad",`Especialidad creada: ${e.nombre}`),this.newEspecialidad={nombre:"",descripcion:""}}):this.messageService.add({severity:"error",summary:"Error",detail:"Nombre y descripci\xF3n son obligatorios"})}registrarBitacora(e,t){this.bitacoraService.getUserIP().subscribe({next:i=>{let o=new Date,a=`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`,x=`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}:${o.getSeconds().toString().padStart(2,"0")}`,S={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:a,hora:x,ip:i.ip,accion:e,detalle:t};this.bitacoraService.createBitacora(S).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:ce=>console.error("Error al registrar en bit\xE1cora",ce)})},error:i=>console.error("Error al obtener IP",i)})}static \u0275fac=function(t){return new(t||n)(_(de),_(w),_(ie),_(B),_(F))};static \u0275cmp=P({type:n,selectors:[["app-especialidad"]],standalone:!0,features:[I([w]),R],decls:17,vars:7,consts:[[1,"form-container"],[1,"form-field"],["for","nombre"],["id","nombre","type","text","pInputText","","placeholder","Nombre de la especialidad",3,"ngModelChange","ngModel"],["for","descripcion"],["id","descripcion","type","text","pInputText","","placeholder","Descripci\xF3n de la especialidad",3,"ngModelChange","ngModel"],[1,"form-field",2,"text-align","center"],["icon","pi pi-save","label","Guardar","styleClass","p-button-raised p-button-warning",3,"click"],["dataKey","id","editMode","row",3,"value","tableStyle","sortField","sortOrder"],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","id",2,"width","20%"],[2,"width","30%"],[2,"width","20%"],[3,"pEditableRow"],["pTemplate","input"],["pTemplate","output"],[1,"flex","align-items-center","justify-content-center","gap-2"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil","class","p-button-rounded p-button-warning","style","width: 2.5rem; height: 2.5rem;",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","icon","pi pi-trash","class","p-button-rounded p-button-danger",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded p-button-check","style","width: 2.5rem; height: 2.5rem;",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded p-button-cancel","style","width: 2.5rem; height: 2.5rem;",3,"click",4,"ngIf"],["pInputText","","type","text","required","",3,"ngModelChange","ngModel"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil",1,"p-button-rounded","p-button-warning",2,"width","2.5rem","height","2.5rem",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-trash",1,"p-button-rounded","p-button-danger",3,"click"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded","p-button-check",2,"width","2.5rem","height","2.5rem",3,"click"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded","p-button-cancel",2,"width","2.5rem","height","2.5rem",3,"click"]],template:function(t,i){t&1&&(k(0,"p-toast"),r(1,"div",0)(2,"h3"),l(3,"Crear Nueva Especialidad"),d(),r(4,"div",1)(5,"label",2),l(6,"Nombre"),d(),r(7,"input",3),C("ngModelChange",function(a){return E(i.newEspecialidad.nombre,a)||(i.newEspecialidad.nombre=a),a}),d()(),r(8,"div",1)(9,"label",4),l(10,"Descripci\xF3n"),d(),r(11,"input",5),C("ngModelChange",function(a){return E(i.newEspecialidad.descripcion,a)||(i.newEspecialidad.descripcion=a),a}),d()(),r(12,"div",6)(13,"p-button",7),b("click",function(){return i.saveEspecialidad()}),d()()(),r(14,"p-table",8),f(15,pe,9,0,"ng-template",9)(16,Ee,17,6,"ng-template",10),d()),t&2&&(p(7),h("ngModel",i.newEspecialidad.nombre),p(4),h("ngModel",i.newEspecialidad.descripcion),p(3),u("value",i.especialidades)("tableStyle",T(6,le))("sortField",i.sortField)("sortOrder",i.sortOrder))},dependencies:[te,K,G,Y,ee,J,Q,X,Z,D,V,re,ae,j,N,W,A,$,H,q,U,L,z,oe,ne],styles:[".form-container[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:100%;margin:auto}.form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a;transition:border-color .3s ease}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:auto;border-radius:8px;overflow:hidden;box-shadow:0 4px 8px #0000001a;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}.p-button-rounded[_ngcontent-%COMP%]{border-radius:50%!important}.p-button-check[_ngcontent-%COMP%]{background-color:#28a745!important;color:#fff!important}.p-button-check[_ngcontent-%COMP%]:hover{background-color:#218838!important}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}"]})};export{y as default};
