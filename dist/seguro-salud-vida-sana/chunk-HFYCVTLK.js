import{a as ie}from"./chunk-DH36QBQF.js";import{a as te}from"./chunk-BFV4IBRI.js";import{a as D}from"./chunk-L2XWMXCQ.js";import{a as Z,b as ee}from"./chunk-TH7K6BJO.js";import{B as X,d as h,f as z,j as R,k as K,l as U,m as H,n as Q,s as Y,t as q,u as G,v as J}from"./chunk-LJKAMAZ5.js";import{b as F,d as V,e as $,f as j,g as W,j as L}from"./chunk-W5NNSEVP.js";import"./chunk-4YRY4IP2.js";import{a as k}from"./chunk-S2R25WKX.js";import{o as T}from"./chunk-V6WZIOIM.js";import{m as B,r as N}from"./chunk-2HP4KZBQ.js";import{$a as m,Ab as w,Bb as v,Cb as E,Db as S,Eb as P,Fb as O,Gb as A,Ka as s,La as l,X as y,Ya as f,ea as u,eb as d,fa as g,fb as o,gb as I,kb as _,nb as b,ob as p,xb as r,yb as M}from"./chunk-TOSOZOFE.js";import"./chunk-ODN5LVDJ.js";var ae=()=>({"min-width":"50rem"});function re(n,t){if(n&1){let e=_();d(0,"div",8)(1,"h3"),r(2,"Informaci\xF3n de la Especialidad"),o(),d(3,"div",1)(4,"label"),r(5,"ID:"),o(),d(6,"span"),r(7),o()(),d(8,"div",1)(9,"label"),r(10,"Nombre:"),o(),d(11,"span"),r(12),o()(),d(13,"div",1)(14,"label"),r(15,"Asignar M\xE9dico"),o(),d(16,"p-dropdown",9),S("ngModelChange",function(a){u(e);let c=p();return E(c.selectedMedicoId,a)||(c.selectedMedicoId=a),g(a)}),o()(),d(17,"div",4)(18,"p-button",10),b("click",function(){u(e);let a=p();return g(a.assignMedico())}),o()()()}if(n&2){let e=p();s(7),M(e.especialidad.id),s(5),M(e.especialidad.nombre),s(4),m("options",e.medicosNoAsignados),v("ngModel",e.selectedMedicoId)}}function ne(n,t){n&1&&(d(0,"tr")(1,"th",14),r(2,"ID M\xE9dico"),o(),d(3,"th"),r(4,"Nombre M\xE9dico"),o(),d(5,"th"),r(6,"Acciones"),o()())}function ce(n,t){if(n&1){let e=_();d(0,"tr")(1,"td"),r(2),o(),d(3,"td"),r(4),o(),d(5,"td")(6,"button",15),b("click",function(){let a=u(e).$implicit,c=p(2);return g(c.deleteMedicoEspecialidad(a.id))}),o()()()}if(n&2){let e=t.$implicit;s(2),M(e.medico.id),s(2),w("",e.medico.usuario.nombre," ",e.medico.usuario.apellido,"")}}function se(n,t){if(n&1&&(d(0,"p-table",11),f(1,ne,7,0,"ng-template",12)(2,ce,7,3,"ng-template",13),o()),n&2){let e=p();m("value",e.medicoEspecialidades)("tableStyle",A(4,ae))("sortField",e.sortField)("sortOrder",e.sortOrder)}}var x=class n{constructor(t,e,i,a,c,C){this.especialidadService=t;this.medicoService=e;this.medicoEspecialidadService=i;this.bitacoraService=a;this.messageService=c;this.authService=C}especialidadId=0;especialidad=null;medicoEspecialidades=[];medicosNoAsignados=[];selectedMedicoId=null;sortField="medico.id";sortOrder=1;ngOnInit(){}buscarEspecialidad(){this.especialidadId>0?this.especialidadService.getEspecialidadById(this.especialidadId).subscribe(t=>{t?(this.especialidad=t,this.buscarMedicoEspecialidades(),this.registrarBitacora("Listar especialidades",`Listar especialidades de ${this.especialidad.nombre}`)):(this.messageService.add({severity:"warn",summary:"Advertencia",detail:"Ingrese un ID de especialidad v\xE1lido"}),this.especialidad=null,this.medicoEspecialidades=[],this.medicosNoAsignados=[])},()=>this.messageService.add({severity:"error",summary:"Error",detail:"Error al buscar la especialidad"})):this.messageService.add({severity:"warn",summary:"Advertencia",detail:"Ingrese un ID de especialidad v\xE1lido"})}buscarMedicoEspecialidades(){this.medicoEspecialidadService.getMedicoEspecialidades().subscribe(t=>{this.medicoEspecialidades=t.filter(e=>e.especialidad.id===this.especialidadId).sort((e,i)=>(e.medico.id||0)-(i.medico.id||0)),this.buscarMedicosNoAsignados()},()=>this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener m\xE9dicos de la especialidad"}))}buscarMedicosNoAsignados(){this.medicoService.getMedicos().subscribe(t=>{let e=this.medicoEspecialidades.map(i=>i.medico.id);this.medicosNoAsignados=t.filter(i=>!e.includes(i.id))})}assignMedico(){if(this.selectedMedicoId){let t={especialidad:this.especialidad,medico:{id:this.selectedMedicoId}};this.medicoEspecialidadService.createMedicoEspecialidad(t).subscribe(()=>{this.buscarMedicoEspecialidades(),this.buscarMedicosNoAsignados();let e=this.medicosNoAsignados.find(i=>i.id===this.selectedMedicoId);this.selectedMedicoId=null,this.messageService.add({severity:"success",summary:"Asignado",detail:"M\xE9dico asignado correctamente"}),e&&this.registrarBitacora("Asignar especialidad",`Asign\xF3 ${this.especialidad?.nombre} a ${e.usuario.nombre} ${e.usuario.apellido}`)},()=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo asignar el m\xE9dico"}))}else this.messageService.add({severity:"error",summary:"Error",detail:"Seleccione un m\xE9dico para asignar"})}deleteMedicoEspecialidad(t){let e=this.medicoEspecialidades.find(i=>i.id===t);this.medicoEspecialidadService.deleteMedicoEspecialidad(t).subscribe(()=>{this.medicoEspecialidades=this.medicoEspecialidades.filter(i=>i.id!==t),this.buscarMedicosNoAsignados(),this.messageService.add({severity:"success",summary:"Eliminado",detail:"M\xE9dico de la especialidad eliminado correctamente"}),e&&this.registrarBitacora("Eliminar especialidad",`Quit\xF3 ${e.especialidad?.nombre} a ${e.medico?.usuario.nombre} ${e.medico?.usuario.apellido}`)})}registrarBitacora(t,e){this.bitacoraService.getUserIP().subscribe({next:i=>{let a=new Date,c=`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`,C=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`,oe={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:c,hora:C,ip:i.ip,accion:t,detalle:e};this.bitacoraService.createBitacora(oe).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:de=>console.error("Error al registrar en bit\xE1cora",de)})},error:i=>console.error("Error al obtener IP",i)})}static \u0275fac=function(e){return new(e||n)(l(ie),l(D),l(te),l(k),l(h),l(T))};static \u0275cmp=y({type:n,selectors:[["app-medico-especialidad"]],standalone:!0,features:[P([h]),O],decls:12,vars:3,consts:[[1,"form-container"],[1,"form-field"],["for","especialidadId"],["id","especialidadId","type","number","pInputText","","placeholder","Ingrese el ID de la especialidad","min","0",3,"ngModelChange","ngModel"],[1,"form-field","center-content"],["icon","pi pi-search","label","Buscar","styleClass","p-button-raised p-button-info button-custom",3,"click"],["class","specialty-info",4,"ngIf"],["dataKey","id","editMode","row",3,"value","tableStyle","sortField","sortOrder",4,"ngIf"],[1,"specialty-info"],["optionLabel","item","optionValue","id","placeholder","Seleccione un m\xE9dico",1,"input-dropdown",3,"ngModelChange","options","ngModel"],["icon","pi pi-plus","label","Asignar","styleClass","p-button-raised p-button-success button-custom",3,"click"],["dataKey","id","editMode","row",3,"value","tableStyle","sortField","sortOrder"],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","medico.id"],["pButton","","pRipple","","type","button","icon","pi pi-trash",1,"p-button-rounded","p-button-danger",3,"click"]],template:function(e,i){e&1&&(I(0,"p-toast"),d(1,"div",0)(2,"h3"),r(3,"Buscar Especialidad por ID"),o(),d(4,"div",1)(5,"label",2),r(6,"ID de la Especialidad"),o(),d(7,"input",3),S("ngModelChange",function(c){return E(i.especialidadId,c)||(i.especialidadId=c),c}),o()(),d(8,"div",4)(9,"p-button",5),b("click",function(){return i.buscarEspecialidad()}),o()(),f(10,re,19,4,"div",6),o(),f(11,se,3,5,"p-table",7)),e&2&&(s(7),v("ngModel",i.especialidadId),s(3),m("ngIf",i.especialidad),s(),m("ngIf",i.medicoEspecialidades.length>0))},dependencies:[ee,Z,z,X,G,J,N,B,L,F,j,V,W,$,Q,U,H,K,R,q,Y],styles:[".form-container[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:100%;margin:auto}.form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-dropdown[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a}.input-dropdown[_ngcontent-%COMP%]:focus, .form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.button-custom[_ngcontent-%COMP%]{width:100%;max-width:150px;font-size:1rem;border-radius:8px;padding:.75rem;margin:auto}.center-content[_ngcontent-%COMP%]{grid-column:1 / -1;text-align:center}.specialty-info[_ngcontent-%COMP%]{grid-column:1 / -1;border-top:1px solid #ddd;padding-top:1.5rem}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:auto;border-radius:8px;overflow:hidden;box-shadow:0 4px 8px #0000001a;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}"]})};export{x as default};
