import{a as Q}from"./chunk-MXFWE3EN.js";import{a as Y}from"./chunk-VQN7VCHG.js";import{a as X}from"./chunk-LOKU4Z3N.js";import{a as Z}from"./chunk-U4TB2UQV.js";import{a as K}from"./chunk-MK7CEOIY.js";import{a as W,b as z}from"./chunk-7ZVYFVUR.js";import{b as J}from"./chunk-434S2MCI.js";import{B as q,f as F,k as B,l as L,n as N,s as j,t as G,u as U,v as $}from"./chunk-WB7R4CTM.js";import{d as k,e as D,j as V}from"./chunk-TCU2USIY.js";import"./chunk-4YRY4IP2.js";import{o as A}from"./chunk-OAPWJZOF.js";import{m as H,p as R,q as T}from"./chunk-4YUBQKU5.js";import{Ab as h,Bb as C,Cb as M,Eb as y,Ja as s,Ka as m,Ob as O,Pb as I,W as w,Xa as f,_a as p,da as u,db as r,ea as g,eb as n,jb as b,mb as _,nb as l,wb as a,xb as v,yb as P}from"./chunk-VM3UWR7T.js";import{a as E,b as S}from"./chunk-ODN5LVDJ.js";function ee(d,i){if(d&1){let e=b();r(0,"div",1)(1,"label",6),a(2,"M\xE9dico"),n(),r(3,"p-dropdown",7),M("ngModelChange",function(o){u(e);let c=l();return C(c.selectedMedico,o)||(c.selectedMedico=o),g(o)}),_("onChange",function(){u(e);let o=l();return g(o.onMedicoChange())}),n()()}if(d&2){let e=l();s(3),p("options",e.medicos),h("ngModel",e.selectedMedico)}}function te(d,i){if(d&1){let e=b();r(0,"div",1)(1,"label",8),a(2,"Horario"),n(),r(3,"p-dropdown",9),M("ngModelChange",function(o){u(e);let c=l();return C(c.selectedHorario,o)||(c.selectedHorario=o),g(o)}),_("onChange",function(){u(e);let o=l();return g(o.onHorarioChange())}),n()()}if(d&2){let e=l();s(3),p("options",e.horarios),h("ngModel",e.selectedHorario)}}function oe(d,i){d&1&&(r(0,"tr")(1,"th",14),a(2,"N\xFAmero"),n(),r(3,"th"),a(4,"Fecha Reservada"),n(),r(5,"th"),a(6,"Hora"),n(),r(7,"th"),a(8,"Estado"),n(),r(9,"th"),a(10,"Asegurado"),n(),r(11,"th"),a(12,"Acci\xF3n"),n()())}function ie(d,i){if(d&1){let e=b();r(0,"button",16),_("click",function(){u(e);let o=l().$implicit,c=l(2);return g(c.reservarCupo(o))}),n()}}function ne(d,i){if(d&1&&(r(0,"tr")(1,"td"),a(2),n(),r(3,"td"),a(4),O(5,"date"),n(),r(6,"td"),a(7),n(),r(8,"td"),a(9),n(),r(10,"td"),a(11),n(),r(12,"td"),f(13,ie,1,0,"button",15),n()()),d&2){let e=i.$implicit;s(2),v(e.numero),s(2),v(e.fechaReservado?I(5,6,e.fechaReservado,"dd/MM/yyyy"):"No reservada"),s(3),v(e.hora),s(2),v(e.estado),s(2),P(" ",e.asegurado?e.asegurado.usuario.nombre+" "+e.asegurado.usuario.apellido:"Sin asegurado"," "),s(2),p("ngIf",e.estado==="Libre")}}function re(d,i){if(d&1&&(r(0,"div",10)(1,"h3"),a(2,"Cupos Disponibles"),n(),r(3,"p-table",11),f(4,oe,13,0,"ng-template",12)(5,ne,14,9,"ng-template",13),n()()),d&2){let e=l();s(3),p("value",e.cupos)("sortField","id")("sortOrder",1)}}var x=class d{constructor(i,e,t,o,c,de){this.especialidadService=i;this.medicoEspecialidadService=e;this.horarioService=t;this.cupoService=o;this.aseguradoService=c;this.authService=de}especialidades=[];horarios=[];cupos=[];selectedEspecialidad=null;selectedMedico=null;selectedMedicoEspecialidad;selectedHorario=null;medicos=[];ngOnInit(){this.obtenerEspecialidades()}obtenerEspecialidades(){this.especialidadService.getEspecialidades().subscribe(i=>{this.especialidades=i})}onEspecialidadChange(){this.selectedEspecialidad&&this.selectedEspecialidad.id!==void 0?this.obtenerMedicosPorEspecialidad(this.selectedEspecialidad.id):this.medicos=[]}obtenerMedicosPorEspecialidad(i){this.medicoEspecialidadService.getMedicoEspecialidades().subscribe(e=>{let t=e.filter(o=>o.especialidad.id===i&&o.medico!==void 0).map(o=>({id:o.medico.id,nombreCompleto:`${o.medico.usuario.nombre} ${o.medico.usuario.apellido}`}));this.medicos=t})}onMedicoChange(){this.selectedEspecialidad?.id!==void 0&&this.selectedMedico?.id!==void 0?this.medicoEspecialidadService.getMedicoEspecialidadByEspecialidadAndMedico(this.selectedEspecialidad.id,this.selectedMedico.id).subscribe(i=>{this.selectedMedicoEspecialidad=i,this.obtenerHorariosPorMedicoEspecialidad(this.selectedMedicoEspecialidad.id)}):this.selectedMedicoEspecialidad=null}obtenerHorariosPorMedicoEspecialidad(i){this.horarioService.getHorariosPorMedicoEspecialidad(i).subscribe(e=>{this.horarios=e.map(t=>S(E({},t),{formattedLabel:`${t.fecha} - ${t.horaInicio} a ${t.horaFinal}`}))})}obtenerCuposPorHorario(i){this.cupoService.getCuposPorHorario(i).subscribe(e=>{this.cupos=e})}onHorarioChange(){this.selectedHorario&&this.selectedHorario.id?this.obtenerCuposPorHorario(this.selectedHorario.id):this.cupos=[]}reservarCupo(i){let e=this.authService.getAuthenticatedUserEmail();e?this.aseguradoService.getAseguradoPorCorreo(e).subscribe(t=>{let o={numero:i.numero,fechaReservado:new Date().toISOString().split("T")[0],estado:"Ocupado",horario:i.horario,asegurado:{id:t.id}};i.id!==void 0?this.cupoService.reservarCupo(i.id,o).subscribe(c=>{console.log("Reserva realizada exitosamente:",c),this.obtenerCuposPorHorario(this.selectedHorario.id)},c=>{console.error("Error al actualizar el cupo:",c)}):console.error("El ID del cupo es undefined. No se puede actualizar el cupo.")},t=>{console.error("Error al obtener el asegurado por correo:",t)}):console.error("No se pudo obtener el correo del asegurado.")}static \u0275fac=function(e){return new(e||d)(m(Q),m(X),m(Y),m(Z),m(K),m(A))};static \u0275cmp=w({type:d,selectors:[["app-reserva"]],standalone:!0,features:[y],decls:10,vars:5,consts:[[1,"form-container","add-usuario-form"],[1,"form-field"],["for","especialidad"],["optionLabel","nombre","placeholder","Seleccione una especialidad",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],["class","form-field",4,"ngIf"],["class","cupo-table",4,"ngIf"],["for","medico"],["optionLabel","nombreCompleto","placeholder","Seleccione un m\xE9dico",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],["for","horario"],["placeholder","Seleccione un horario","optionLabel","formattedLabel",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],[1,"cupo-table"],[3,"value","sortField","sortOrder"],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","id"],["pButton","","type","button","label","Reservar","class","p-button-success",3,"click",4,"ngIf"],["pButton","","type","button","label","Reservar",1,"p-button-success",3,"click"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h3"),a(2,"Seleccione Especialidad, M\xE9dico y Horario"),n(),r(3,"div",1)(4,"label",2),a(5,"Especialidad"),n(),r(6,"p-dropdown",3),M("ngModelChange",function(c){return C(t.selectedEspecialidad,c)||(t.selectedEspecialidad=c),c}),_("onChange",function(){return t.onEspecialidadChange()}),n()(),f(7,ee,4,2,"div",4)(8,te,4,2,"div",4),n(),f(9,re,6,3,"div",5)),e&2&&(s(6),p("options",t.especialidades),h("ngModel",t.selectedEspecialidad),s(),p("ngIf",t.medicos.length>0),s(),p("ngIf",t.horarios.length>0),s(),p("ngIf",t.cupos.length>0))},dependencies:[T,H,R,J,F,G,j,q,U,$,V,k,D,N,L,B,z,W],styles:[".usuario-list-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;overflow-x:auto}.form-container.add-usuario-form[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem}.form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.6rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333}.input-dropdown[_ngcontent-%COMP%], .input-field[_ngcontent-%COMP%]{width:100%;max-width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a}.input-dropdown[_ngcontent-%COMP%]:focus, .input-field[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.cupo-table[_ngcontent-%COMP%]{width:100%;max-width:100%;padding:1rem;border-radius:12px;background-color:#fff;box-shadow:0 4px 8px #0000001a;margin-top:1.5rem}.p-table[_ngcontent-%COMP%]{width:100%;border-radius:8px;overflow:hidden;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:12px;text-align:center;font-weight:700}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:center;vertical-align:middle}.p-button-success[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important;border:none!important;border-radius:8px!important;padding:.5rem 1rem;font-weight:700;transition:background-color .3s ease}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}.cupo-table[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}"]})};export{x as default};
