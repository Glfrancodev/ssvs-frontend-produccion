import{a as ae}from"./chunk-2XS4SXXB.js";import{a as se}from"./chunk-ORJ34YTS.js";import{a as J,b as X}from"./chunk-GVW476NT.js";import{a as ie,b as ne}from"./chunk-PYYOUPNA.js";import{B as oe,d as v,f as L,j as G,k as K,l as Q,m as Y,n as q,s as Z,t as ee,u as te,v as re}from"./chunk-ZUZBKQRE.js";import{b as H,d as V,e as j,f as U,g as W,j as z}from"./chunk-BDNZXGBE.js";import"./chunk-4YRY4IP2.js";import{a as F}from"./chunk-J46H7NZA.js";import{a as D,b as $,o as P}from"./chunk-XYYWSSR3.js";import{m as B,r as N}from"./chunk-Y5VG4NV3.js";import{Ab as C,Bb as M,Cb as I,Db as A,Eb as T,Fb as k,Ja as m,Ka as d,M as w,R as S,W as O,Xa as h,_a as u,da as g,db as i,ea as b,eb as o,fb as E,jb as x,mb as f,nb as c,wb as a,xb as p}from"./chunk-VM3UWR7T.js";import"./chunk-ODN5LVDJ.js";var _=class n{constructor(t,e){this.http=t;this.authService=e}apiUrl="https://ssvs-backend-produccion-production.up.railway.app/api/rol-permiso";getAuthHeaders(){return new D({"Content-Type":"application/json",Authorization:`Bearer ${this.authService.getToken()}`})}getRolPermisos(){return this.http.get(this.apiUrl,{headers:this.getAuthHeaders()})}getRolPermisoById(t){return this.http.get(`${this.apiUrl}/${t}`,{headers:this.getAuthHeaders()})}createRolPermiso(t){return this.http.post(this.apiUrl,t,{headers:this.getAuthHeaders()})}updateRolPermiso(t){return this.http.put(`${this.apiUrl}/${t.id}`,t,{headers:this.getAuthHeaders()})}deleteRolPermiso(t){return this.http.delete(`${this.apiUrl}/${t}`,{headers:this.getAuthHeaders()})}static \u0275fac=function(e){return new(e||n)(S($),S(P))};static \u0275prov=w({token:n,factory:n.\u0275fac,providedIn:"root"})};var ue=()=>({"min-width":"50rem"});function ge(n,t){if(n&1){let e=x();i(0,"div",8)(1,"h3"),a(2,"Informaci\xF3n del Rol"),o(),i(3,"div",1)(4,"label"),a(5,"ID:"),o(),i(6,"span"),a(7),o()(),i(8,"div",1)(9,"label"),a(10,"Nombre:"),o(),i(11,"span"),a(12),o()(),i(13,"div",9)(14,"label"),a(15,"Asignar Permiso"),o(),i(16,"p-dropdown",10),I("ngModelChange",function(s){g(e);let l=c();return M(l.selectedPermisoId,s)||(l.selectedPermisoId=s),b(s)}),o()(),i(17,"div",11)(18,"p-button",12),f("click",function(){g(e);let s=c();return b(s.assignPermiso())}),o()()()}if(n&2){let e=c();m(7),p(e.rol.id),m(5),p(e.rol.nombre),m(4),u("options",e.permisosNoAsignados),C("ngModel",e.selectedPermisoId)}}function be(n,t){n&1&&(i(0,"tr")(1,"th",16),a(2,"ID Permiso"),o(),i(3,"th",17),a(4,"Nombre Permiso"),o(),i(5,"th",18),a(6,"Descripci\xF3n"),o(),i(7,"th",19),a(8,"Acciones"),o()())}function he(n,t){if(n&1){let e=x();i(0,"tr")(1,"td"),a(2),o(),i(3,"td"),a(4),o(),i(5,"td"),a(6),o(),i(7,"td")(8,"button",20),f("click",function(){let s=g(e).$implicit,l=c(2);return b(l.deleteRolPermiso(s.id))}),o()()()}if(n&2){let e=t.$implicit;m(2),p(e.permiso.id),m(2),p(e.permiso.nombre),m(2),p(e.permiso.descripcion)}}function fe(n,t){if(n&1&&(i(0,"p-table",13),h(1,be,9,0,"ng-template",14)(2,he,9,3,"ng-template",15),o()),n&2){let e=c();u("value",e.rolPermisos)("tableStyle",k(4,ue))("sortField",e.sortField)("sortOrder",e.sortOrder)}}var R=class n{constructor(t,e,r,s,l,y){this.rolService=t;this.permisoService=e;this.rolPermisoService=r;this.bitacoraService=s;this.authService=l;this.messageService=y}rolId=0;rol=null;rolPermisos=[];permisosNoAsignados=[];selectedPermisoId=null;sortField="permiso.id";sortOrder=1;ngOnInit(){}registrarBitacora(t,e){this.bitacoraService.getUserIP().subscribe({next:r=>{let s=new Date,l=`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")}`,y=`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}:${s.getSeconds().toString().padStart(2,"0")}`,le={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:l,hora:y,ip:r.ip,accion:t,detalle:e};this.bitacoraService.createBitacora(le).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:me=>console.error("Error al registrar en bit\xE1cora",me)})},error:r=>console.error("Error al obtener IP",r)})}buscarRol(){this.rolId>0?this.rolService.getRolById(this.rolId).subscribe(t=>{t?(this.rol=t,this.buscarRolPermisos(),this.registrarBitacora("Listar Permisos",`Listar permisos de ${t.nombre}`)):(this.messageService.add({severity:"warn",summary:"Advertencia",detail:"Ingrese un ID de rol v\xE1lido"}),this.rol=null,this.rolPermisos=[],this.permisosNoAsignados=[])},()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al buscar el rol"})}):this.messageService.add({severity:"warn",summary:"Advertencia",detail:"Ingrese un ID de rol v\xE1lido"})}buscarRolPermisos(){this.rolPermisoService.getRolPermisos().subscribe(t=>{this.rolPermisos=t.filter(e=>e.rol.id===this.rolId).sort((e,r)=>(e.permiso.id||0)-(r.permiso.id||0)),this.buscarPermisosNoAsignados()},()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener permisos del rol"})})}buscarPermisosNoAsignados(){this.permisoService.getPermisos().subscribe(t=>{let e=this.rolPermisos.map(r=>r.permiso.id);this.permisosNoAsignados=t.filter(r=>!e.includes(r.id))})}assignPermiso(){if(this.selectedPermisoId){let t=this.permisosNoAsignados.find(r=>r.id===this.selectedPermisoId),e={rol:this.rol,permiso:{id:this.selectedPermisoId}};this.rolPermisoService.createRolPermiso(e).subscribe(()=>{this.buscarRolPermisos(),this.buscarPermisosNoAsignados(),this.messageService.add({severity:"success",summary:"Asignado",detail:"Permiso asignado correctamente"}),this.registrarBitacora("Asignar Permiso",`Asign\xF3 ${t?.nombre} a ${this.rol?.nombre}`),this.selectedPermisoId=null},()=>{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo asignar el permiso"})})}else this.messageService.add({severity:"error",summary:"Error",detail:"Seleccione un permiso para asignar"})}deleteRolPermiso(t){let e=this.rolPermisos.find(r=>r.id===t);this.rolPermisoService.deleteRolPermiso(t).subscribe(()=>{this.rolPermisos=this.rolPermisos.filter(r=>r.id!==t),this.buscarPermisosNoAsignados(),this.messageService.add({severity:"success",summary:"Eliminado",detail:"Permiso del rol eliminado correctamente"}),this.registrarBitacora("Eliminar Permiso",`Quit\xF3 ${e?.permiso.nombre} de ${this.rol?.nombre}`)})}static \u0275fac=function(e){return new(e||n)(d(se),d(ae),d(_),d(F),d(P),d(v))};static \u0275cmp=O({type:n,selectors:[["app-rol-permiso"]],standalone:!0,features:[A([v]),T],decls:12,vars:3,consts:[[1,"form-container"],[1,"form-field"],["for","rolId"],["id","rolId","type","number","pInputText","","placeholder","Ingrese el ID del rol","min","0",3,"ngModelChange","ngModel"],[1,"form-field",2,"text-align","center"],["icon","pi pi-search","label","Buscar","styleClass","p-button-raised p-button-info",3,"click"],["style","margin-top: 20px; border-top: 1px solid #ddd; padding-top: 20px;",4,"ngIf"],["dataKey","id","editMode","row",3,"value","tableStyle","sortField","sortOrder",4,"ngIf"],[2,"margin-top","20px","border-top","1px solid #ddd","padding-top","20px"],[1,"form-field",2,"margin-top","20px"],["optionLabel","nombre","optionValue","id","placeholder","Seleccione un permiso",3,"ngModelChange","options","ngModel"],[1,"form-field",2,"text-align","center","margin-top","10px"],["icon","pi pi-plus","label","Asignar","styleClass","p-button-raised p-button-success",3,"click"],["dataKey","id","editMode","row",3,"value","tableStyle","sortField","sortOrder"],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","permiso.id",2,"width","10%"],[2,"width","30%"],[2,"width","40%"],[2,"width","20%"],["pButton","","pRipple","","type","button","icon","pi pi-trash",1,"p-button-rounded","p-button-danger",3,"click"]],template:function(e,r){e&1&&(E(0,"p-toast"),i(1,"div",0)(2,"h3"),a(3,"Buscar Rol por ID"),o(),i(4,"div",1)(5,"label",2),a(6,"ID del Rol"),o(),i(7,"input",3),I("ngModelChange",function(l){return M(r.rolId,l)||(r.rolId=l),l}),o()(),i(8,"div",4)(9,"p-button",5),f("click",function(){return r.buscarRol()}),o()(),h(10,ge,19,4,"div",6),o(),h(11,fe,3,5,"p-table",7)),e&2&&(m(7),C("ngModel",r.rolId),m(3),u("ngIf",r.rol),m(),u("ngIf",r.rolPermisos.length>0))},dependencies:[ne,ie,L,oe,te,re,N,B,z,H,U,V,W,j,q,Q,Y,K,G,X,J,ee,Z],styles:[".form-container[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #ddd;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;max-width:100%;margin:auto}.form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]{margin-bottom:1rem;display:flex;flex-direction:column}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}input[pInputText][_ngcontent-%COMP%], .p-dropdown[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a;transition:border-color .3s ease}input[pInputText][_ngcontent-%COMP%]:focus, .p-dropdown[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.p-button-info[_ngcontent-%COMP%], .p-button-success[_ngcontent-%COMP%]{font-size:1rem;border-radius:8px;width:100%;max-width:150px;margin:auto;box-shadow:0 2px 6px #00000026}.p-button-info[_ngcontent-%COMP%]:hover{background-color:#007bb5!important}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:auto;border-radius:8px;overflow:hidden;box-shadow:0 4px 8px #0000001a;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}.p-button-rounded.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-rounded.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}"]})};export{R as default};
