import{a as te}from"./chunk-Q26NN6CS.js";import{a as ie}from"./chunk-UG6A2FXP.js";import{a as G,b as U}from"./chunk-GVW476NT.js";import{a as Z,b as ee}from"./chunk-PYYOUPNA.js";import{B as X,d as f,f as $,k as j,l as V,m as R,n as z,p as K,q as Y,s as q,t as J,u as Q}from"./chunk-ZUZBKQRE.js";import{b as D,d as W,e as k,f as L,j as N}from"./chunk-BDNZXGBE.js";import"./chunk-4YRY4IP2.js";import{a as B}from"./chunk-J46H7NZA.js";import{o as A}from"./chunk-XYYWSSR3.js";import{r as F}from"./chunk-Y5VG4NV3.js";import{Ab as p,Bb as g,Cb as u,Db as I,Eb as P,Fb as O,Ja as l,Ka as s,W as v,Xa as b,Zb as T,_a as _,da as w,db as o,ea as H,eb as r,fb as x,jb as y,mb as M,nb as h,wb as n,xb as m,yb as C}from"./chunk-VM3UWR7T.js";import"./chunk-ODN5LVDJ.js";var ae=()=>({"min-width":"50rem","max-width":"100%"});function ne(c,t){if(c&1&&n(0),c&2){let i=t.$implicit,e=h();C(" ",e.getMedicoEspecialidadLabel(i)," ")}}function de(c,t){if(c&1&&n(0),c&2){let i=t.$implicit,e=h();C(" ",e.getMedicoEspecialidadLabel(i)," ")}}function ce(c,t){c&1&&(o(0,"tr")(1,"th",19),n(2,"ID"),r(),o(3,"th",20),n(4,"Fecha"),r(),o(5,"th",20),n(6,"Hora Inicio"),r(),o(7,"th",20),n(8,"Hora Final"),r(),o(9,"th",19),n(10,"Cupos Totales"),r(),o(11,"th",21),n(12,"Descripci\xF3n"),r(),o(13,"th",20),n(14,"Acciones"),r()())}function le(c,t){if(c&1){let i=y();o(0,"tr")(1,"td"),n(2),r(),o(3,"td"),n(4),r(),o(5,"td"),n(6),r(),o(7,"td"),n(8),r(),o(9,"td"),n(10),r(),o(11,"td"),n(12),r(),o(13,"td")(14,"button",22),M("click",function(){let d=w(i).$implicit,a=h();return H(a.deleteHorario(d.id))}),r()()()}if(c&2){let i=t.$implicit,e=h();l(2),m(i.id),l(2),m(i.fecha),l(2),m(i.horaInicio),l(2),m(i.horaFinal),l(2),m(i.cantidadCupos),l(2),m(e.getMedicoEspecialidadLabel(i.medicoEspecialidad))}}var S=class c{constructor(t,i,e,d,a,E){this.horarioService=t;this.medicoEspecialidadService=i;this.bitacoraService=e;this.messageService=d;this.cdr=a;this.authService=E}horarios=[];medicoEspecialidades=[];editedHorarios={};newHorario={fecha:"",horaInicio:"",horaFinal:"",cantidadCupos:0,medicoEspecialidad:{id:0}};ngOnInit(){this.getAllHorarios(),this.getAllMedicoEspecialidades()}getAllHorarios(){this.horarioService.getHorarios().subscribe(t=>{this.horarios=t,this.sortHorarios()})}getAllMedicoEspecialidades(){this.medicoEspecialidadService.getMedicoEspecialidades().subscribe(t=>{this.medicoEspecialidades=t})}sortHorarios(){this.horarios.sort((t,i)=>(t.id||0)-(i.id||0))}addHorario(){this.newHorario.medicoEspecialidad&&this.newHorario.medicoEspecialidad.id?this.horarioService.createHorario(this.newHorario).subscribe(t=>{this.horarioService.getHorarioById(t.id).subscribe(i=>{this.getAllHorarios(),this.messageService.add({severity:"success",summary:"Horario Agregado",detail:"Nuevo horario creado correctamente"});let e=this.getMedicoEspecialidadLabel(i.medicoEspecialidad);this.registrarBitacora("A\xF1adir horario",`A\xF1adir horario (${i.fecha}) desde (${i.horaInicio}) hasta las (${i.horaFinal}) a (${e})`),this.newHorario={fecha:"",horaInicio:"",horaFinal:"",cantidadCupos:0,medicoEspecialidad:{id:0}}})},t=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo a\xF1adir el horario"})):this.messageService.add({severity:"error",summary:"Error",detail:"Debe seleccionar un m\xE9dico y especialidad"})}getMedicoEspecialidadLabel(t){let i=t?.especialidad?.nombre||"Sin especialidad",e=t?.medico?.usuario?.nombre||"Nombre desconocido",d=t?.medico?.usuario?.apellido||"Apellido desconocido";return`Especialidad: ${i} - M\xE9dico: ${e} ${d}`}deleteHorario(t){let i=this.horarios.find(e=>e.id===t);this.horarioService.deleteHorario(t).subscribe(()=>{if(this.horarios=this.horarios.filter(e=>e.id!==t),this.messageService.add({severity:"success",summary:"Horario Eliminado",detail:"El horario ha sido eliminado correctamente"}),i){let e=this.getMedicoEspecialidadLabel(i);this.registrarBitacora("Eliminar horario",`Se elimin\xF3 horario (${i.fecha}) desde (${i.horaInicio}) hasta las (${i.horaFinal}) a (${e})`)}})}registrarBitacora(t,i){this.bitacoraService.getUserIP().subscribe({next:e=>{let d=new Date,a=`${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,"0")}-${d.getDate().toString().padStart(2,"0")}`,E=`${d.getHours().toString().padStart(2,"0")}:${d.getMinutes().toString().padStart(2,"0")}:${d.getSeconds().toString().padStart(2,"0")}`,oe={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:a,hora:E,ip:e.ip,accion:t,detalle:i};this.bitacoraService.createBitacora(oe).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:re=>console.error("Error al registrar en bit\xE1cora",re)})},error:e=>console.error("Error al obtener IP",e)})}static \u0275fac=function(i){return new(i||c)(s(te),s(ie),s(B),s(f),s(T),s(A))};static \u0275cmp=v({type:c,selectors:[["app-horario"]],standalone:!0,features:[I([f]),P],decls:31,vars:9,consts:[[1,"add-horario-form"],[1,"form-field"],["for","fecha"],["id","fecha","dateFormat","yy-mm-dd",1,"input-calendar",3,"ngModelChange","ngModel"],["for","horaInicio"],["id","horaInicio","type","time","pInputText","","placeholder","Ingrese la hora de inicio",3,"ngModelChange","ngModel"],["for","horaFinal"],["id","horaFinal","type","time","pInputText","","placeholder","Ingrese la hora final",3,"ngModelChange","ngModel"],["for","cantidadCupos"],["id","cantidadCupos","type","number","pInputText","","placeholder","Ingrese la cantidad de cupos",3,"ngModelChange","ngModel"],["for","medicoEspecialidad"],["id","medicoEspecialidad","optionValue","id","placeholder","Seleccione M\xE9dico Especialidad",1,"input-dropdown",3,"ngModelChange","options","ngModel"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"form-field","center-content"],["label","A\xF1adir Horario","icon","pi pi-plus","styleClass","p-button-raised p-button-success button-custom",3,"click"],["dataKey","id","editMode","row",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"width","10%"],[2,"width","15%"],[2,"width","20%"],["pButton","","icon","pi pi-trash",1,"p-button-rounded","p-button-danger","button-danger",3,"click"]],template:function(i,e){i&1&&(x(0,"p-toast"),o(1,"div",0)(2,"h3"),n(3,"A\xF1adir Nuevo Horario"),r(),o(4,"div",1)(5,"label",2),n(6,"Fecha"),r(),o(7,"p-calendar",3),u("ngModelChange",function(a){return g(e.newHorario.fecha,a)||(e.newHorario.fecha=a),a}),r()(),o(8,"div",1)(9,"label",4),n(10,"Hora de Inicio"),r(),o(11,"input",5),u("ngModelChange",function(a){return g(e.newHorario.horaInicio,a)||(e.newHorario.horaInicio=a),a}),r()(),o(12,"div",1)(13,"label",6),n(14,"Hora Final"),r(),o(15,"input",7),u("ngModelChange",function(a){return g(e.newHorario.horaFinal,a)||(e.newHorario.horaFinal=a),a}),r()(),o(16,"div",1)(17,"label",8),n(18,"Cantidad de Cupos"),r(),o(19,"input",9),u("ngModelChange",function(a){return g(e.newHorario.cantidadCupos,a)||(e.newHorario.cantidadCupos=a),a}),r()(),o(20,"div",1)(21,"label",10),n(22,"M\xE9dico Especialidad"),r(),o(23,"p-dropdown",11),u("ngModelChange",function(a){return g(e.newHorario.medicoEspecialidad.id,a)||(e.newHorario.medicoEspecialidad.id=a),a}),b(24,ne,1,1,"ng-template",12)(25,de,1,1,"ng-template",13),r()(),o(26,"div",14)(27,"p-button",15),M("click",function(){return e.addHorario()}),r()()(),o(28,"p-table",16),b(29,ce,15,0,"ng-template",17)(30,le,15,6,"ng-template",18),r()),i&2&&(l(7),p("ngModel",e.newHorario.fecha),l(4),p("ngModel",e.newHorario.horaInicio),l(4),p("ngModel",e.newHorario.horaFinal),l(4),p("ngModel",e.newHorario.cantidadCupos),l(4),_("options",e.medicoEspecialidades),p("ngModel",e.newHorario.medicoEspecialidad.id),l(5),_("value",e.horarios)("tableStyle",O(8,ae)))},dependencies:[ee,Z,$,X,Q,F,N,D,L,W,k,z,V,R,j,U,G,J,q,Y,K],styles:[".form-container[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #ddd;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:100%;margin:auto}.add-horario-form[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}.input-calendar[_ngcontent-%COMP%], .input-dropdown[_ngcontent-%COMP%], input[type=time][_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a}.input-calendar[_ngcontent-%COMP%]:focus, .input-dropdown[_ngcontent-%COMP%]:focus, input[type=time][_ngcontent-%COMP%]:focus, input[type=number][_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.button-custom[_ngcontent-%COMP%]{width:100%;max-width:150px;font-size:1rem;border-radius:8px;padding:.75rem;margin:auto}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:auto;border-radius:8px;overflow:hidden;box-shadow:0 4px 8px #0000001a;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}"]})};export{S as default};
