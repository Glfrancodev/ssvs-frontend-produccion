import{a as z}from"./chunk-XVX7D3AE.js";import"./chunk-HWUH7ABB.js";import"./chunk-JCJIXIGU.js";import{a as G,b as H}from"./chunk-37FNDG3E.js";import{B as q,f as A,k as N,l as W,n as j,u as L}from"./chunk-LJKAMAZ5.js";import{b as F,d as R,e as T,j as V}from"./chunk-W5NNSEVP.js";import"./chunk-4YRY4IP2.js";import{a as k}from"./chunk-S2R25WKX.js";import"./chunk-V6WZIOIM.js";import{l as w,m as O,p as D,r as I}from"./chunk-2HP4KZBQ.js";import{$a as p,Bb as x,Cb as C,Db as v,Fb as B,Gb as y,Ka as r,La as b,Pb as E,Qb as P,X as M,Ya as u,ea as f,eb as t,fa as _,fb as i,kb as h,nb as s,ob as g,xb as a,yb as m}from"./chunk-TOSOZOFE.js";import"./chunk-ODN5LVDJ.js";var K=()=>({"min-width":"50rem","max-width":"100%"});function Q(l,o){if(l&1){let e=h();t(0,"div")(1,"input",16),s("change",function(){let d=f(e).$implicit,c=g(2);return _(c.toggleSeleccionColumna(d))}),i(),t(2,"label"),a(3),i()()}if(l&2){let e=o.$implicit;r(),p("checked",e.seleccionada),r(2),m(e.titulo)}}function U(l,o){if(l&1){let e=h();t(0,"div",13)(1,"h4"),a(2,"Selecciona las columnas a exportar:"),i(),u(3,Q,4,2,"div",14),t(4,"button",15),s("click",function(){f(e);let d=g();return _(d.exportarBitacora())}),i()()}if(l&2){let e=g();r(3),p("ngForOf",e.columnasDisponibles)}}function X(l,o){l&1&&(t(0,"tr")(1,"th"),a(2,"ID"),i(),t(3,"th"),a(4,"Correo"),i(),t(5,"th"),a(6,"Fecha"),i(),t(7,"th"),a(8,"Hora"),i(),t(9,"th"),a(10,"IP"),i(),t(11,"th"),a(12,"Acci\xF3n"),i(),t(13,"th"),a(14,"Detalle"),i()())}function Y(l,o){if(l&1&&(t(0,"tr")(1,"td"),a(2),i(),t(3,"td"),a(4),i(),t(5,"td"),a(6),E(7,"date"),i(),t(8,"td"),a(9),i(),t(10,"td"),a(11),i(),t(12,"td"),a(13),i(),t(14,"td"),a(15),i()()),l&2){let e=o.$implicit;r(2),m(e.id),r(2),m(e.correo),r(2),m(P(7,7,e.fecha,"dd/MM/yyyy")),r(3),m(e.hora),r(2),m(e.ip),r(2),m(e.accion),r(2),m(e.detalle)}}var S=class l{constructor(o,e){this.bitacoraService=o;this.pdfExportService=e}bitacoras=[];selectedRange={start:new Date,end:new Date};mostrarSeleccionColumnas=!1;columnasDisponibles=[{campo:"id",titulo:"ID",seleccionada:!0},{campo:"correo",titulo:"Correo",seleccionada:!0},{campo:"fecha",titulo:"Fecha",seleccionada:!0},{campo:"hora",titulo:"Hora",seleccionada:!0},{campo:"ip",titulo:"IP",seleccionada:!0},{campo:"accion",titulo:"Acci\xF3n",seleccionada:!0},{campo:"detalle",titulo:"Detalle",seleccionada:!0}];ngOnInit(){this.getAllBitacoras()}getAllBitacoras(){this.bitacoraService.getBitacoras().subscribe(o=>{this.bitacoras=o.sort((e,n)=>(n.id??0)-(e.id??0))})}filterByDateRange(){let o=new Date(this.selectedRange.start),e=new Date(this.selectedRange.end);this.bitacoraService.getBitacorasByDateRange(o,e).subscribe(n=>{this.bitacoras=n.sort((d,c)=>(c.id??0)-(d.id??0))})}toggleSeleccionColumna(o){o.seleccionada=!o.seleccionada}exportarBitacora(){let o=this.columnasDisponibles.filter(n=>n.seleccionada),e=this.bitacoras.map(n=>{let d={};return o.forEach(c=>{let J=c.campo;d[c.campo]=n[J]||""}),d});this.pdfExportService.exportBitacora(e,o,"Registro de Bit\xE1cora","bitacora")}static \u0275fac=function(e){return new(e||l)(b(k),b(z))};static \u0275cmp=M({type:l,selectors:[["app-bitacora"]],standalone:!0,features:[B],decls:17,vars:6,consts:[[1,"bitacora-container"],[1,"filter-date-range"],["for","start-date"],["type","date","id","start-date",3,"ngModelChange","ngModel"],["for","end-date"],["type","date","id","end-date",3,"ngModelChange","ngModel"],["pButton","","label","Filtrar","icon","pi pi-filter",3,"click"],[1,"column-selector-container"],["pButton","","type","button","label","Exportaci\xF3n","icon","pi pi-cog",3,"click"],["class","column-selector",4,"ngIf"],[3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[1,"column-selector"],[4,"ngFor","ngForOf"],["pButton","","type","button","label","Exportar Seleccionadas","icon","pi pi-file-pdf",3,"click"],["type","checkbox",3,"change","checked"]],template:function(e,n){e&1&&(t(0,"div",0)(1,"h3"),a(2,"Registro de Bit\xE1cora"),i(),t(3,"div",1)(4,"label",2),a(5,"Fecha Inicio:"),i(),t(6,"input",3),v("ngModelChange",function(c){return C(n.selectedRange.start,c)||(n.selectedRange.start=c),c}),i(),t(7,"label",4),a(8,"Fecha Fin:"),i(),t(9,"input",5),v("ngModelChange",function(c){return C(n.selectedRange.end,c)||(n.selectedRange.end=c),c}),i(),t(10,"button",6),s("click",function(){return n.filterByDateRange()}),i()(),t(11,"div",7)(12,"button",8),s("click",function(){return n.mostrarSeleccionColumnas=!n.mostrarSeleccionColumnas}),i()(),u(13,U,5,1,"div",9),t(14,"p-table",10),u(15,X,15,0,"ng-template",11)(16,Y,16,10,"ng-template",12),i()()),e&2&&(r(6),x("ngModel",n.selectedRange.start),r(3),x("ngModel",n.selectedRange.end),r(4),p("ngIf",n.mostrarSeleccionColumnas),r(),p("value",n.bitacoras)("tableStyle",y(5,K)))},dependencies:[I,w,O,D,q,L,A,V,F,R,T,j,W,N,H,G],styles:[".bitacora-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;overflow-x:auto}h3[_ngcontent-%COMP%]{text-align:center;color:#3f51b5;font-weight:700}.filter-date-range[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem;align-items:center}.filter-date-range[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700}.filter-date-range[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border-radius:5px;border:1px solid #ddd}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:0 auto;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #00000026}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9f9f9}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e3f2fd}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center}"]})};export{S as default};
