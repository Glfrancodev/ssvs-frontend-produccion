import{a as j}from"./chunk-XVX7D3AE.js";import"./chunk-HWUH7ABB.js";import"./chunk-JCJIXIGU.js";import{a as V}from"./chunk-MZW6JDJM.js";import{a as $}from"./chunk-64ACLIH3.js";import{B as N,f as T,l as A,n as D,u as F}from"./chunk-LJKAMAZ5.js";import"./chunk-W5NNSEVP.js";import"./chunk-4YRY4IP2.js";import{j as w,o as I}from"./chunk-V6WZIOIM.js";import{l as y,m as O,p as H,r as k}from"./chunk-2HP4KZBQ.js";import{$a as p,Ab as x,Fb as S,Gb as E,Ka as l,La as d,Pb as M,Qb as P,X as b,Ya as h,ea as g,eb as i,fa as C,fb as o,kb as _,nb as u,ob as f,xb as n,yb as m}from"./chunk-TOSOZOFE.js";import"./chunk-ODN5LVDJ.js";var R=()=>({"min-width":"50rem","max-width":"100%"});function z(r,t){if(r&1){let e=_();i(0,"div")(1,"input",10),u("change",function(){let c=g(e).$implicit,s=f(2);return C(s.toggleSeleccionColumna(c))}),o(),i(2,"label"),n(3),o()()}if(r&2){let e=t.$implicit;l(),p("checked",e.seleccionada),l(2),m(e.titulo)}}function U(r,t){if(r&1){let e=_();i(0,"div",7)(1,"h4"),n(2,"Selecciona las columnas a exportar:"),o(),h(3,z,4,2,"div",8),i(4,"button",9),u("click",function(){g(e);let c=f();return C(c.exportarHistoriaClinica())}),o()()}if(r&2){let e=f();l(3),p("ngForOf",e.columnasDisponibles)}}function q(r,t){r&1&&(i(0,"tr")(1,"th"),n(2,"Fecha de Consulta"),o(),i(3,"th"),n(4,"Motivo"),o(),i(5,"th"),n(6,"Diagn\xF3stico"),o(),i(7,"th"),n(8,"Nota"),o(),i(9,"th"),n(10,"M\xE9dico"),o(),i(11,"th"),n(12,"Acciones"),o()())}function G(r,t){if(r&1){let e=_();i(0,"tr")(1,"td"),n(2),M(3,"date"),o(),i(4,"td"),n(5),o(),i(6,"td"),n(7),o(),i(8,"td"),n(9),o(),i(10,"td"),n(11),o(),i(12,"td")(13,"button",11),u("click",function(){let c=g(e).$implicit,s=f();return C(s.irATratamiento(c.id))}),o()()()}if(r&2){let e=t.$implicit;l(2),m(P(3,6,e.fechaConsulta,"dd/MM/yyyy")),l(3),m(e.motivoConsulta),l(2),m(e.diagnostico),l(2),m(e.nota),l(2),x("",(e.cupo==null||e.cupo.horario==null||e.cupo.horario.medicoEspecialidad==null||e.cupo.horario.medicoEspecialidad.medico==null||e.cupo.horario.medicoEspecialidad.medico.usuario==null?null:e.cupo.horario.medicoEspecialidad.medico.usuario.nombre)||""," ",(e.cupo==null||e.cupo.horario==null||e.cupo.horario.medicoEspecialidad==null||e.cupo.horario.medicoEspecialidad.medico==null||e.cupo.horario.medicoEspecialidad.medico.usuario==null?null:e.cupo.horario.medicoEspecialidad.medico.usuario.apellido)||""," ")}}var v=class r{constructor(t,e,a,c,s){this.consultaService=t;this.authService=e;this.aseguradoService=a;this.pdfExportService=c;this.router=s}consultas=[];aseguradoDatos=[];mostrarSeleccionColumnas=!1;columnasDisponibles=[{campo:"fechaConsulta",titulo:"Fecha de Consulta",seleccionada:!0},{campo:"motivoConsulta",titulo:"Motivo",seleccionada:!0},{campo:"diagnostico",titulo:"Diagn\xF3stico",seleccionada:!0},{campo:"nota",titulo:"Nota",seleccionada:!0},{campo:"medico",titulo:"M\xE9dico",seleccionada:!0}];toggleSeleccionColumna(t){t.seleccionada=!t.seleccionada}ngOnInit(){this.cargarHistoriaClinica()}cargarHistoriaClinica(){let t=this.authService.getAuthenticatedUserEmail();t?this.aseguradoService.getAseguradoPorCorreo(t).subscribe(e=>{e.historiaClinica?.id!==void 0?(this.obtenerConsultasPorHistoriaClinica(e.historiaClinica.id),this.aseguradoDatos=[`Nombre: ${e.usuario?.nombre} ${e.usuario?.apellido}`,`CI: ${e.usuario?.ci}`,`Fecha de Nacimiento: ${e.fechaNacimiento}`,`Tipo de Sangre: ${e.tipoSangre||"N/A"}`]):console.error("El asegurado no tiene una historia cl\xEDnica asignada.")},e=>console.error("Error al obtener el asegurado:",e)):console.error("No se pudo obtener el correo del asegurado.")}obtenerConsultasPorHistoriaClinica(t){this.consultaService.getConsultasPorHistoriaClinicaId(t).subscribe(e=>{this.consultas=e,console.log("Consultas obtenidas:",this.consultas)},e=>console.error("Error al obtener las consultas:",e))}exportarHistoriaClinica(){let t=this.columnasDisponibles.filter(a=>a.seleccionada),e=this.consultas.map(a=>{let c={};return t.forEach(s=>{if(s.campo==="medico")c[s.campo]=`${a.cupo?.horario?.medicoEspecialidad?.medico?.usuario?.nombre||""} ${a.cupo?.horario?.medicoEspecialidad?.medico?.usuario?.apellido||""}`;else{let B=s.campo;c[s.campo]=a[B]||""}}),c});this.pdfExportService.exportHistoriaClinica(e,t,"Historia Cl\xEDnica","historia_clinica")}irATratamiento(t){this.router.navigate(["/tratamiento",t])}static \u0275fac=function(e){return new(e||r)(d(V),d(I),d($),d(j),d(w))};static \u0275cmp=b({type:r,selectors:[["app-mi-historia-clinica"]],standalone:!0,features:[S],decls:9,vars:4,consts:[[1,"historia-clinica-container"],[1,"column-selector-container"],["pButton","","type","button","label","Exportaci\xF3n","icon","pi pi-cog",3,"click"],["class","column-selector",4,"ngIf"],[3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[1,"column-selector"],[4,"ngFor","ngForOf"],["pButton","","type","button","label","Exportar Seleccionadas","icon","pi pi-file-pdf",3,"click"],["type","checkbox",3,"change","checked"],["pButton","","type","button","icon","pi pi-arrow-right",1,"p-button-rounded","p-button-info",3,"click"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"h3"),n(2,"Historia Cl\xEDnica"),o(),i(3,"div",1)(4,"button",2),u("click",function(){return a.mostrarSeleccionColumnas=!a.mostrarSeleccionColumnas}),o()(),h(5,U,5,1,"div",3),i(6,"p-table",4),h(7,q,13,0,"ng-template",5)(8,G,14,9,"ng-template",6),o()()),e&2&&(l(5),p("ngIf",a.mostrarSeleccionColumnas),l(),p("value",a.consultas)("tableStyle",E(3,R)))},dependencies:[N,F,T,k,y,O,H,D,A],styles:["h3[_ngcontent-%COMP%]{text-align:center;color:#3f51b5;font-weight:700;font-size:1.8rem;margin:0 0 20px;border-bottom:2px solid #ddd;padding-bottom:.5rem}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:0 auto;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #00000026}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f5f5f5}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:center;vertical-align:middle}.p-button-info[_ngcontent-%COMP%]{background-color:#1e88e5!important;border:none!important;color:#fff!important}.p-button-info[_ngcontent-%COMP%]:hover{background-color:#1565c0!important}.p-button-rounded[_ngcontent-%COMP%]{width:36px;height:36px;display:flex;align-items:center;justify-content:center}"]})};export{v as default};
