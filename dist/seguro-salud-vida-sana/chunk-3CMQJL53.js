import{a as L}from"./chunk-XVX7D3AE.js";import"./chunk-HWUH7ABB.js";import"./chunk-JCJIXIGU.js";import{a as G}from"./chunk-UJ32YO6L.js";import{a as z}from"./chunk-MZW6JDJM.js";import{a as U}from"./chunk-64ACLIH3.js";import{a as N,b as R}from"./chunk-37FNDG3E.js";import{B as j,f as H,k as B,l as F,n as D,u as V}from"./chunk-LJKAMAZ5.js";import{j as $}from"./chunk-W5NNSEVP.js";import"./chunk-4YRY4IP2.js";import{a as k}from"./chunk-S2R25WKX.js";import{h as T,j as y,o as A}from"./chunk-V6WZIOIM.js";import{l as O,m as I,r as w}from"./chunk-2HP4KZBQ.js";import{$a as p,Fb as E,Gb as P,Ka as l,La as m,X as M,Ya as h,ea as v,eb as i,fa as b,fb as o,kb as C,nb as g,ob as f,xb as a,yb as d}from"./chunk-TOSOZOFE.js";import"./chunk-ODN5LVDJ.js";var Y=()=>({"min-width":"50rem","max-width":"100%"});function q(s,e){if(s&1){let t=C();i(0,"div")(1,"input",10),g("change",function(){let r=v(t).$implicit,c=f(2);return b(c.toggleSeleccionColumna(r))}),o(),i(2,"label"),a(3),o()()}if(s&2){let t=e.$implicit;l(),p("checked",t.seleccionada),l(2),d(t.titulo)}}function J(s,e){if(s&1){let t=C();i(0,"div",7)(1,"h4"),a(2,"Selecciona las columnas a exportar:"),o(),h(3,q,4,2,"div",8),i(4,"button",9),g("click",function(){v(t);let r=f();return b(r.exportarHistoriaClinica())}),o()()}if(s&2){let t=f();l(3),p("ngForOf",t.columnasDisponibles)}}function Q(s,e){s&1&&(i(0,"tr")(1,"th",11),a(2,"ID Consulta"),o(),i(3,"th",12),a(4,"Fecha Consulta"),o(),i(5,"th",13),a(6,"Motivo Consulta"),o(),i(7,"th",12),a(8,"Diagn\xF3stico"),o(),i(9,"th",12),a(10,"Nota"),o(),i(11,"th",14),a(12,"Acciones"),o()())}function W(s,e){if(s&1){let t=C();i(0,"tr")(1,"td"),a(2),o(),i(3,"td"),a(4),o(),i(5,"td"),a(6),o(),i(7,"td"),a(8),o(),i(9,"td"),a(10),o(),i(11,"td")(12,"button",15),g("click",function(){let r=v(t).$implicit,c=f();return b(c.irATratamiento(r.id))}),o()()()}if(s&2){let t=e.$implicit;l(2),d(t.id),l(2),d(t.fechaConsulta),l(2),d(t.motivoConsulta),l(2),d(t.diagnostico),l(2),d(t.nota)}}var _=class s{constructor(e,t,n,r,c,u,S,x){this.router=e;this.route=t;this.aseguradoService=n;this.consultaService=r;this.tratamientoService=c;this.bitacoraService=u;this.authService=S;this.pdfExportService=x}asegurado=null;mostrarSeleccionColumnas=!1;columnasDisponibles=[{campo:"id",titulo:"ID Consulta",seleccionada:!0},{campo:"fechaConsulta",titulo:"Fecha Consulta",seleccionada:!0},{campo:"motivoConsulta",titulo:"Motivo Consulta",seleccionada:!0},{campo:"diagnostico",titulo:"Diagn\xF3stico",seleccionada:!0},{campo:"nota",titulo:"Nota",seleccionada:!0}];consultas=[];ngOnInit(){this.route.paramMap.subscribe(e=>{let t=Number(e.get("aseguradoId"));t&&this.obtenerAsegurado(t)})}obtenerAsegurado(e){this.aseguradoService.getAseguradoById(e).subscribe(t=>{this.asegurado=t,t.historiaClinica&&t.historiaClinica.id&&this.obtenerConsultas(t.historiaClinica.id)},t=>{console.error("Error al obtener el asegurado:",t)})}obtenerConsultas(e){this.consultaService.getConsultasPorHistoriaClinicaId(e).subscribe(t=>{this.consultas=t,this.verificarTratamientos()},t=>{console.error("Error al obtener las consultas:",t)})}verificarTratamientos(){this.consultas.forEach(e=>{e.id!==void 0?this.tratamientoService.getTratamientoByConsultaId(e.id).subscribe(t=>{e.tieneTratamiento=!!t},t=>{e.tieneTratamiento=!1}):e.tieneTratamiento=!1})}registrarBitacora(e,t,n){this.bitacoraService.getUserIP().subscribe({next:r=>{let c=new Date,u=`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}-${c.getDate().toString().padStart(2,"0")}`,S=`${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}:${c.getSeconds().toString().padStart(2,"0")}`,x={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:u,hora:S,ip:r.ip,accion:e,detalle:t};this.bitacoraService.createBitacora(x).subscribe({next:()=>{console.log("Registro de bit\xE1cora exitoso"),n()},error:K=>{console.error("Error al registrar en bit\xE1cora",K),n()}})},error:r=>{console.error("Error al obtener IP",r),n()}})}irATratamiento(e){if(this.asegurado){let t=`${this.asegurado.usuario.nombre} ${this.asegurado.usuario.apellido}`,n=`Listar tratamiento de la consulta (${e}) del paciente (${t})`;this.registrarBitacora("Listar tratamiento",n,()=>{this.router.navigate(["/tratamiento",e])})}else console.error("El asegurado no est\xE1 disponible."),this.router.navigate(["/tratamiento",e])}toggleSeleccionColumna(e){e.seleccionada=!e.seleccionada}exportarHistoriaClinica(){let e=this.columnasDisponibles.filter(r=>r.seleccionada),t=this.consultas.map(r=>{let c={};return e.forEach(u=>{c[u.campo]=r[u.campo]||""}),c}),n=this.asegurado?[`Nombre: ${this.asegurado.usuario?.nombre||""} ${this.asegurado.usuario?.apellido||""}`,`CI: ${this.asegurado.usuario?.ci||""}`,`Fecha de Nacimiento: ${this.asegurado.fechaNacimiento||""}`,`Tipo de Sangre: ${this.asegurado.tipoSangre||""}`]:[];this.pdfExportService.exportHistoriaClinica(t,e,"Historia Cl\xEDnica","historia_clinica",n)}static \u0275fac=function(t){return new(t||s)(m(y),m(T),m(U),m(z),m(G),m(k),m(A),m(L))};static \u0275cmp=M({type:s,selectors:[["app-historia-clinica"]],standalone:!0,features:[E],decls:9,vars:4,consts:[[1,"column-selector-container"],["pButton","","type","button","label","Exportaci\xF3n","icon","pi pi-cog",3,"click"],["class","column-selector",4,"ngIf"],[1,"historia-clinica-container"],["dataKey","id",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[1,"column-selector"],[4,"ngFor","ngForOf"],["pButton","","type","button","label","Exportar Seleccionadas","icon","pi pi-file-pdf",3,"click"],["type","checkbox",3,"change","checked"],[2,"width","15%"],[2,"width","20%"],[2,"width","25%"],[2,"width","10%"],["pButton","","type","button","icon","pi pi-arrow-right",1,"p-button-rounded","p-button-text","p-button-info",3,"click"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"button",1),g("click",function(){return n.mostrarSeleccionColumnas=!n.mostrarSeleccionColumnas}),o()(),h(2,J,5,1,"div",2),i(3,"div",3)(4,"h3"),a(5,"Historia Cl\xEDnica de Usuario"),o(),i(6,"p-table",4),h(7,Q,13,0,"ng-template",5)(8,W,13,5,"ng-template",6),o()()),t&2&&(l(2),p("ngIf",n.mostrarSeleccionColumnas),l(4),p("value",n.consultas)("tableStyle",P(3,Y)))},dependencies:[w,O,I,j,V,H,$,D,F,B,R,N],styles:[".historia-clinica-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;padding:1.5rem;background-color:#f9f9f9;border-radius:12px;box-shadow:0 4px 8px #0000001a}.historia-clinica-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1.5rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.p-table[_ngcontent-%COMP%]{width:100%;border-radius:8px;overflow:hidden;font-size:.95rem;box-shadow:0 4px 8px #0000001a}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:12px;text-align:center;font-weight:700}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}.p-button-info[_ngcontent-%COMP%]{background-color:#3f51b5!important;color:#fff!important;width:2.5rem;height:2.5rem;border-radius:50%;transition:background-color .3s ease}.p-button-info[_ngcontent-%COMP%]:hover{background-color:#2c3e9e!important}.column-selector-container[_ngcontent-%COMP%]{margin-bottom:1rem}.column-selector[_ngcontent-%COMP%]{background:#f9f9f9;padding:1rem;border-radius:8px;box-shadow:0 2px 4px #0000001a}.column-selector[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:.5rem}.column-selector[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:.25rem}.column-selector[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem}"]})};export{_ as default};
