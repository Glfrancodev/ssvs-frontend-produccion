import{a as q}from"./chunk-XVX7D3AE.js";import"./chunk-HWUH7ABB.js";import"./chunk-JCJIXIGU.js";import{a as G,b as H}from"./chunk-37FNDG3E.js";import{B as z,f as A,k as N,l as W,n as j,u as L}from"./chunk-LJKAMAZ5.js";import{b as F,d as R,e as T,j as V}from"./chunk-W5NNSEVP.js";import"./chunk-4YRY4IP2.js";import{a as k}from"./chunk-S2R25WKX.js";import"./chunk-V6WZIOIM.js";import{l as w,m as O,p as D,r as I}from"./chunk-2HP4KZBQ.js";import{$a as p,Bb as h,Cb as C,Db as v,Fb as B,Gb as y,Ka as r,La as b,Pb as E,Qb as P,X as M,Ya as u,ea as f,eb as t,fa as _,fb as n,kb as x,nb as s,ob as g,xb as o,yb as m}from"./chunk-TOSOZOFE.js";import"./chunk-ODN5LVDJ.js";var K=()=>({"min-width":"50rem","max-width":"100%"});function Q(l,a){if(l&1){let e=x();t(0,"div")(1,"input",16),s("change",function(){let d=f(e).$implicit,c=g(2);return _(c.toggleSeleccionColumna(d))}),n(),t(2,"label"),o(3),n()()}if(l&2){let e=a.$implicit;r(),p("checked",e.seleccionada),r(2),m(e.titulo)}}function U(l,a){if(l&1){let e=x();t(0,"div",13)(1,"h4"),o(2,"Selecciona las columnas a exportar:"),n(),u(3,Q,4,2,"div",14),t(4,"button",15),s("click",function(){f(e);let d=g();return _(d.exportarBitacora())}),n()()}if(l&2){let e=g();r(3),p("ngForOf",e.columnasDisponibles)}}function X(l,a){l&1&&(t(0,"tr")(1,"th"),o(2,"ID"),n(),t(3,"th"),o(4,"Correo"),n(),t(5,"th"),o(6,"Fecha"),n(),t(7,"th"),o(8,"Hora"),n(),t(9,"th"),o(10,"IP"),n(),t(11,"th"),o(12,"Acci\xF3n"),n(),t(13,"th"),o(14,"Detalle"),n()())}function Y(l,a){if(l&1&&(t(0,"tr")(1,"td"),o(2),n(),t(3,"td"),o(4),n(),t(5,"td"),o(6),E(7,"date"),n(),t(8,"td"),o(9),n(),t(10,"td"),o(11),n(),t(12,"td"),o(13),n(),t(14,"td"),o(15),n()()),l&2){let e=a.$implicit;r(2),m(e.id),r(2),m(e.correo),r(2),m(P(7,7,e.fecha,"dd/MM/yyyy")),r(3),m(e.hora),r(2),m(e.ip),r(2),m(e.accion),r(2),m(e.detalle)}}var S=class l{constructor(a,e){this.bitacoraService=a;this.pdfExportService=e}bitacoras=[];selectedRange={start:new Date,end:new Date};mostrarSeleccionColumnas=!1;columnasDisponibles=[{campo:"id",titulo:"ID",seleccionada:!0},{campo:"correo",titulo:"Correo",seleccionada:!0},{campo:"fecha",titulo:"Fecha",seleccionada:!0},{campo:"hora",titulo:"Hora",seleccionada:!0},{campo:"ip",titulo:"IP",seleccionada:!0},{campo:"accion",titulo:"Acci\xF3n",seleccionada:!0},{campo:"detalle",titulo:"Detalle",seleccionada:!0}];ngOnInit(){this.getAllBitacoras()}getAllBitacoras(){this.bitacoraService.getBitacoras().subscribe(a=>{this.bitacoras=a.sort((e,i)=>(i.id??0)-(e.id??0))})}filterByDateRange(){let a=new Date(this.selectedRange.start),e=new Date(this.selectedRange.end);this.bitacoraService.getBitacorasByDateRange(a,e).subscribe(i=>{this.bitacoras=i.sort((d,c)=>(c.id??0)-(d.id??0))})}toggleSeleccionColumna(a){a.seleccionada=!a.seleccionada}exportarBitacora(){let a=this.columnasDisponibles.filter(i=>i.seleccionada),e=this.bitacoras.map(i=>{let d={};return a.forEach(c=>{let J=c.campo;d[c.campo]=i[J]||""}),d});this.pdfExportService.exportBitacora(e,a,"Registro de Bit\xE1cora","bitacora")}static \u0275fac=function(e){return new(e||l)(b(k),b(q))};static \u0275cmp=M({type:l,selectors:[["app-bitacora"]],standalone:!0,features:[B],decls:17,vars:6,consts:[[1,"bitacora-container"],[1,"filter-date-range"],["for","start-date"],["type","date","id","start-date",3,"ngModelChange","ngModel"],["for","end-date"],["type","date","id","end-date",3,"ngModelChange","ngModel"],["pButton","","label","Filtrar","icon","pi pi-filter",3,"click"],[1,"column-selector-container"],["pButton","","type","button","label","Exportaci\xF3n","icon","pi pi-cog",3,"click"],["class","column-selector",4,"ngIf"],[3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[1,"column-selector"],[4,"ngFor","ngForOf"],["pButton","","type","button","label","Exportar Seleccionadas","icon","pi pi-file-pdf",3,"click"],["type","checkbox",3,"change","checked"]],template:function(e,i){e&1&&(t(0,"div",0)(1,"h3"),o(2,"Registro de Bit\xE1cora"),n(),t(3,"div",1)(4,"label",2),o(5,"Fecha Inicio:"),n(),t(6,"input",3),v("ngModelChange",function(c){return C(i.selectedRange.start,c)||(i.selectedRange.start=c),c}),n(),t(7,"label",4),o(8,"Fecha Fin:"),n(),t(9,"input",5),v("ngModelChange",function(c){return C(i.selectedRange.end,c)||(i.selectedRange.end=c),c}),n(),t(10,"button",6),s("click",function(){return i.filterByDateRange()}),n()(),t(11,"div",7)(12,"button",8),s("click",function(){return i.mostrarSeleccionColumnas=!i.mostrarSeleccionColumnas}),n()(),u(13,U,5,1,"div",9),t(14,"p-table",10),u(15,X,15,0,"ng-template",11)(16,Y,16,10,"ng-template",12),n()()),e&2&&(r(6),h("ngModel",i.selectedRange.start),r(3),h("ngModel",i.selectedRange.end),r(4),p("ngIf",i.mostrarSeleccionColumnas),r(),p("value",i.bitacoras)("tableStyle",y(5,K)))},dependencies:[I,w,O,D,z,L,A,V,F,R,T,j,W,N,H,G],styles:[".historia-clinica-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;overflow-x:auto}h3[_ngcontent-%COMP%]{text-align:center;color:#3f51b5;font-weight:700;font-size:1.8rem;margin-bottom:20px;border-bottom:2px solid #ddd;padding-bottom:.5rem}.column-selector-container[_ngcontent-%COMP%]{margin-bottom:1rem}.column-selector[_ngcontent-%COMP%]{background:#f9f9f9;padding:1rem;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:1rem}.column-selector[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:.5rem}.column-selector[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:.25rem}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:0 auto;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #00000026}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f5f5f5}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:center;vertical-align:middle}"]})};export{S as default};
