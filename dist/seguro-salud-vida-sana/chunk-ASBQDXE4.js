import{a as X}from"./chunk-WBEXYDI3.js";import{a as ee}from"./chunk-3OCTHQ56.js";import{a as Z}from"./chunk-QZX63QLI.js";import{a as ie}from"./chunk-VAO66HGS.js";import{a as z,b as G}from"./chunk-BNUNU2GP.js";import{a as J,b as Q}from"./chunk-O3KWYK2S.js";import{B as q,f as j,k,n as R,s as U,t as K,u as Y}from"./chunk-RDO4C5ZH.js";import"./chunk-4YRY4IP2.js";import{d as A,e as W,j as N}from"./chunk-24563CTF.js";import{a as V}from"./chunk-WURDNOJS.js";import{o as F}from"./chunk-EALBQTKK.js";import{m as $,p as D,q as L}from"./chunk-5DWL5JJZ.js";import{$a as h,Ab as a,Bb as f,Cb as I,Eb as C,Fb as _,Gb as v,Ib as H,Jb as O,Na as c,Oa as m,Sb as T,Tb as B,_ as y,a as x,b as w,cb as s,ha as u,hb as r,ia as g,ib as n,jb as P,nb as M,qb as b,rb as p}from"./chunk-3RWLLOHT.js";var ne=()=>({"min-width":"50rem"});function re(d,t){if(d&1){let e=M();r(0,"div",1)(1,"label",6),a(2,"M\xE9dico"),n(),r(3,"p-dropdown",7),v("ngModelChange",function(i){u(e);let l=p();return _(l.selectedMedico,i)||(l.selectedMedico=i),g(i)}),b("onChange",function(){u(e);let i=p();return g(i.onMedicoChange())}),n()()}if(d&2){let e=p();c(3),s("options",e.medicos),C("ngModel",e.selectedMedico)}}function de(d,t){if(d&1){let e=M();r(0,"div",1)(1,"label",8),a(2,"Horario"),n(),r(3,"p-dropdown",9),v("ngModelChange",function(i){u(e);let l=p();return _(l.selectedHorario,i)||(l.selectedHorario=i),g(i)}),b("onChange",function(){u(e);let i=p();return g(i.onHorarioChange())}),n()()}if(d&2){let e=p();c(3),s("options",e.horarios),C("ngModel",e.selectedHorario)}}function ae(d,t){d&1&&(r(0,"tr")(1,"th"),a(2,"N\xFAmero"),n(),r(3,"th"),a(4,"Fecha Reservada"),n(),r(5,"th"),a(6,"Hora"),n(),r(7,"th"),a(8,"Estado"),n(),r(9,"th"),a(10,"Asegurado"),n()())}function ce(d,t){if(d&1&&(r(0,"tr")(1,"td"),a(2),n(),r(3,"td"),a(4),T(5,"date"),n(),r(6,"td"),a(7),n(),r(8,"td"),a(9),n(),r(10,"td"),a(11),n()()),d&2){let e=t.$implicit;c(2),f(e.numero),c(2),f(e.fechaReservado?B(5,5,e.fechaReservado,"dd/MM/yyyy"):"No reservada"),c(3),f(e.hora),c(2),f(e.estado),c(2),I(" ",e.asegurado?e.asegurado.usuario.nombre+" "+e.asegurado.usuario.apellido:"Sin asegurado"," ")}}function le(d,t){if(d&1&&(r(0,"div",10)(1,"h3"),a(2,"Cupos Disponibles"),n(),r(3,"p-table",11),h(4,ae,11,0,"ng-template",12)(5,ce,12,8,"ng-template",13),n()()),d&2){let e=p();c(3),s("value",e.cupos)("tableStyle",O(2,ne))}}var S=class d{constructor(t,e,o,i,l,E){this.especialidadService=t;this.medicoEspecialidadService=e;this.horarioService=o;this.cupoService=i;this.bitacoraService=l;this.authService=E}especialidades=[];horarios=[];cupos=[];selectedEspecialidad=null;selectedMedico=null;selectedMedicoEspecialidad;selectedHorario=null;medicos=[];ngOnInit(){this.obtenerEspecialidades()}obtenerEspecialidades(){this.especialidadService.getEspecialidades().subscribe(t=>{this.especialidades=t})}onEspecialidadChange(){this.selectedEspecialidad&&this.selectedEspecialidad.id!==void 0?this.obtenerMedicosPorEspecialidad(this.selectedEspecialidad.id):this.medicos=[]}obtenerMedicosPorEspecialidad(t){this.medicoEspecialidadService.getMedicoEspecialidades().subscribe(e=>{let o=e.filter(i=>i.especialidad.id===t&&i.medico!==void 0).map(i=>({id:i.medico.id,nombreCompleto:`${i.medico.usuario.nombre} ${i.medico.usuario.apellido}`}));this.medicos=o})}onMedicoChange(){this.selectedEspecialidad?.id!==void 0&&this.selectedMedico?.id!==void 0?this.medicoEspecialidadService.getMedicoEspecialidadByEspecialidadAndMedico(this.selectedEspecialidad.id,this.selectedMedico.id).subscribe(t=>{this.selectedMedicoEspecialidad=t,console.log("MedicoEspecialidad seleccionado:",this.selectedMedicoEspecialidad),this.obtenerHorariosPorMedicoEspecialidad(this.selectedMedicoEspecialidad.id)}):this.selectedMedicoEspecialidad=null}obtenerHorariosPorMedicoEspecialidad(t){this.horarioService.getHorariosPorMedicoEspecialidad(t).subscribe(e=>{this.horarios=e.map(o=>w(x({},o),{label:`${o.fecha} - ${o.horaInicio} a ${o.horaFinal}`}))})}obtenerCuposPorHorario(t){this.cupoService.getCuposPorHorario(t).subscribe(e=>{this.cupos=e})}onHorarioChange(){if(this.selectedHorario&&this.selectedHorario.id){this.obtenerCuposPorHorario(this.selectedHorario.id);let t=this.selectedEspecialidad?.nombre||"Especialidad desconocida",e=`${this.selectedMedico?.usuario?.nombre||"Nombre desconocido"} ${this.selectedMedico?.usuario?.apellido||"Apellido desconocido"}`,o=`${this.selectedHorario.fecha} de ${this.selectedHorario.horaInicio} a ${this.selectedHorario.horaFinal}`;this.registrarBitacora("Listar cupos",`Listar cupos de ${t} de ${e} el ${o}`)}else this.cupos=[]}registrarBitacora(t,e){this.bitacoraService.getUserIP().subscribe({next:o=>{let i=new Date,l=`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getDate().toString().padStart(2,"0")}`,E=`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}:${i.getSeconds().toString().padStart(2,"0")}`,oe={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:l,hora:E,ip:o.ip,accion:t,detalle:e};this.bitacoraService.createBitacora(oe).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:te=>console.error("Error al registrar en bit\xE1cora",te)})},error:o=>console.error("Error al obtener IP",o)})}static \u0275fac=function(e){return new(e||d)(m(X),m(Z),m(ee),m(ie),m(V),m(F))};static \u0275cmp=y({type:d,selectors:[["app-cupo"]],standalone:!0,features:[H],decls:11,vars:5,consts:[[1,"form-container","add-usuario-form"],[1,"form-field"],["for","especialidad"],["optionLabel","nombre","placeholder","Seleccione una especialidad",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],["class","form-field",4,"ngIf"],["class","cupo-table",4,"ngIf"],["for","medico"],["optionLabel","nombreCompleto","placeholder","Seleccione un m\xE9dico",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],["for","horario"],["optionLabel","label","placeholder","Seleccione un horario",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],[1,"cupo-table"],["dataKey","numero",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"]],template:function(e,o){e&1&&(P(0,"p-toast"),r(1,"div",0)(2,"h3"),a(3,"Seleccione Especialidad, M\xE9dico y Horario"),n(),r(4,"div",1)(5,"label",2),a(6,"Especialidad"),n(),r(7,"p-dropdown",3),v("ngModelChange",function(l){return _(o.selectedEspecialidad,l)||(o.selectedEspecialidad=l),l}),b("onChange",function(){return o.onEspecialidadChange()}),n()(),h(8,re,4,2,"div",4)(9,de,4,2,"div",4),n(),h(10,le,6,3,"div",5)),e&2&&(c(7),s("options",o.especialidades),C("ngModel",o.selectedEspecialidad),c(),s("ngIf",o.medicos.length>0),c(),s("ngIf",o.horarios.length>0),c(),s("ngIf",o.cupos.length>0))},dependencies:[L,$,D,Q,J,j,K,U,q,Y,N,A,W,R,k,G,z],styles:[".form-container[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem}.form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}.input-dropdown[_ngcontent-%COMP%]{width:100%;max-width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a}.input-dropdown[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.cupo-table[_ngcontent-%COMP%]{width:100%;max-width:100%;padding:1rem;border-radius:12px;background-color:#fff;box-shadow:0 4px 8px #0000001a;margin-top:1.5rem}.cupo-table[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}"]})};export{S as default};
