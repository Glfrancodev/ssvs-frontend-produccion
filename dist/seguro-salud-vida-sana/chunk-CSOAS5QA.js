import{a as se}from"./chunk-GB72KSVT.js";import{a as ae}from"./chunk-LSYYTESY.js";import{a as re,b as ne}from"./chunk-O3KWYK2S.js";import{A as ie,B as oe,d as A,f as L,j as $,k as z,l as H,n as G,p as K,q as Y,s as q,t as J,u as Q,w as X,x as Z,y as ee,z as te}from"./chunk-RDO4C5ZH.js";import"./chunk-4YRY4IP2.js";import{b as D,d as F,e as W,i as U,j}from"./chunk-24563CTF.js";import{a as V}from"./chunk-WURDNOJS.js";import{o as N}from"./chunk-EALBQTKK.js";import{m as B,q as O}from"./chunk-5DWL5JJZ.js";import{$a as C,Ab as d,Bb as b,Db as T,Eb as h,Fb as S,Gb as v,Hb as k,Ib as P,Jb as R,Na as u,Oa as g,_ as M,a as E,cb as c,ha as p,hb as o,ia as m,ib as r,jb as I,nb as _,qb as f,rb as l}from"./chunk-3RWLLOHT.js";var ue=()=>({"min-width":"50rem","max-width":"100%"});function le(s,t){s&1&&(o(0,"tr")(1,"th",16),d(2,"ID"),r(),o(3,"th",17),d(4,"Tipo de Sangre"),r(),o(5,"th",16),d(6,"Sexo"),r(),o(7,"th",18),d(8,"Fecha de Nacimiento"),r(),o(9,"th",19),d(10,"Nombre Completo"),r(),o(11,"th",20),d(12,"Id Historia"),r(),o(13,"th",16),d(14,"Acci\xF3n"),r()())}function ce(s,t){if(s&1&&d(0),s&2){let e=l().$implicit;b(e.tipoSangre)}}function pe(s,t){if(s&1){let e=_();o(0,"input",29),v("ngModelChange",function(a){p(e);let n=l().$implicit;return S(n.tipoSangre,a)||(n.tipoSangre=a),m(a)}),r()}if(s&2){let e=l().$implicit;h("ngModel",e.tipoSangre)}}function me(s,t){if(s&1){let e=_();o(0,"button",30),f("click",function(){p(e);let a=l().$implicit,n=l();return m(n.onRowEditInit(a))}),r()}}function ge(s,t){if(s&1){let e=_();o(0,"button",31),f("click",function(){p(e);let a=l().$implicit,n=l();return m(n.onRowEditSave(a))}),r()}}function _e(s,t){if(s&1){let e=_();o(0,"button",32),f("click",function(){p(e);let a=l(),n=a.$implicit,x=a.rowIndex,w=l();return m(w.onRowEditCancel(n,x))}),r()}}function fe(s,t){if(s&1){let e=_();o(0,"button",33),f("click",function(){p(e);let a=l().$implicit,n=l();return m(n.deleteAsegurado(a.id))}),r()}}function be(s,t){if(s&1&&(o(0,"tr",21)(1,"td"),d(2),r(),o(3,"td")(4,"p-cellEditor"),C(5,ce,1,1,"ng-template",22)(6,pe,1,1,"ng-template",23),r()(),o(7,"td"),d(8),r(),o(9,"td"),d(10),r(),o(11,"td"),d(12),r(),o(13,"td"),d(14),r(),o(15,"td")(16,"div",24),C(17,me,1,0,"button",25)(18,ge,1,0,"button",26)(19,_e,1,0,"button",27)(20,fe,1,0,"button",28),r()()()),s&2){let e=t.$implicit,i=t.editing;c("pEditableRow",e),u(2),b(e.id),u(6),b(e.sexo),u(2),b(e.fechaNacimiento),u(2),T("",e.usuario==null?null:e.usuario.nombre," ",e.usuario==null?null:e.usuario.apellido,""),u(2),b(e.historiaClinica.id),u(3),c("ngIf",!i),u(),c("ngIf",i),u(),c("ngIf",i),u(),c("ngIf",!i)}}var y=class s{constructor(t,e,i,a,n){this.aseguradoService=t;this.usuarioService=e;this.messageService=i;this.bitacoraService=a;this.authService=n}asegurados=[];usuariosDisponibles=[];nuevoAsegurado={tipoSangre:"",sexo:"",fechaNacimiento:"",usuario:{id:0,ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0,rol:void 0},historiaClinica:{id:0}};editedAsegurados={};sortField="id";sortOrder=1;ngOnInit(){this.getAsegurados(),this.getUsuariosDisponibles()}getAsegurados(){this.aseguradoService.getAsegurados().subscribe(t=>this.asegurados=t,t=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los asegurados"}))}registrarBitacora(t,e){this.bitacoraService.getUserIP().subscribe({next:i=>{let a=new Date,n=`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`,x=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`,w={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:n,hora:x,ip:i.ip,accion:t,detalle:e};this.bitacoraService.createBitacora(w).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:de=>console.error("Error al registrar en bit\xE1cora",de)})},error:i=>console.error("Error al obtener IP",i)})}getUsuariosDisponibles(){this.usuarioService.getUsuariosSinAseguradoByRol(2).subscribe(t=>this.usuariosDisponibles=t,t=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los usuarios disponibles"}))}addAsegurado(){let t=this.nuevoAsegurado.usuario?.correo;this.aseguradoService.createAsegurado(this.nuevoAsegurado).subscribe(e=>{this.getAsegurados(),this.asegurados.push(e),this.messageService.add({severity:"success",summary:"A\xF1adido",detail:"Asegurado a\xF1adido correctamente"}),this.registrarBitacora("A\xF1adir asegurado",`Asegurado creado: ${t}`),this.resetNuevoAsegurado(),this.getUsuariosDisponibles()},e=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo a\xF1adir el asegurado"}))}resetNuevoAsegurado(){this.nuevoAsegurado={tipoSangre:"",sexo:"",fechaNacimiento:"",usuario:{id:0,ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0,rol:void 0},historiaClinica:{id:0}}}deleteAsegurado(t){let e=this.asegurados.find(i=>i.id===t);if(!e){this.messageService.add({severity:"error",summary:"Error",detail:"Asegurado no encontrado"});return}this.aseguradoService.deleteAsegurado(t).subscribe(()=>{this.asegurados=this.asegurados.filter(i=>i.id!==t),this.messageService.add({severity:"success",summary:"Eliminado",detail:"Asegurado eliminado correctamente"}),this.registrarBitacora("Eliminar asegurado",`Asegurado eliminado: ${e?.usuario?.correo}`),this.getUsuariosDisponibles()},i=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el asegurado"}))}onRowEditInit(t){this.editedAsegurados[t.id]=E({},t),this.messageService.add({severity:"info",summary:"Edici\xF3n",detail:"Editando tipo de sangre"})}onRowEditSave(t){this.aseguradoService.updateAsegurado(t).subscribe(()=>{delete this.editedAsegurados[t.id],this.messageService.add({severity:"success",summary:"Guardado",detail:"Tipo de sangre actualizado"}),this.registrarBitacora("Modificar asegurado",`Asegurado modificado: ${t.usuario?.correo}`)})}onRowEditCancel(t,e){this.asegurados[e]=this.editedAsegurados[t.id]||t,delete this.editedAsegurados[t.id],this.messageService.add({severity:"info",summary:"Cancelado",detail:"Edici\xF3n cancelada"})}static \u0275fac=function(e){return new(e||s)(g(se),g(ae),g(A),g(V),g(N))};static \u0275cmp=M({type:s,selectors:[["app-asegurado"]],standalone:!0,features:[k([A]),P],decls:26,vars:10,consts:[[1,"add-asegurado-form"],[1,"form-field"],["for","tipoSangre"],["id","tipoSangre","pInputText","","placeholder","Ingrese el tipo de sangre",1,"input-field",3,"ngModelChange","ngModel"],["for","sexo"],["id","sexo","pInputText","","placeholder","Ingrese el sexo","maxlength","1",1,"input-field",3,"ngModelChange","ngModel"],["for","fechaNacimiento"],["dateFormat","yy-mm-dd",1,"input-calendar",3,"ngModelChange","ngModel"],["for","usuario"],["id","usuario","optionLabel","correo","optionValue","id","placeholder","Seleccione un usuario",1,"input-dropdown",3,"ngModelChange","options","ngModel"],[1,"form-field","button-container"],["pButton","","label","A\xF1adir Asegurado",1,"p-button-success",3,"click"],[1,"asegurado-list-container",2,"margin-top","2rem"],["dataKey","id","editMode","row",3,"value","tableStyle","sortField","sortOrder"],["pTemplate","header"],["pTemplate","body"],[2,"width","10%"],[2,"width","15%"],[2,"width","20%"],[2,"width","30%"],[2,"width","5%"],[3,"pEditableRow"],["pTemplate","output"],["pTemplate","input"],[1,"flex","align-items-center","justify-content-center","gap-2"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil","class","p-button-rounded",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded p-button-success",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded p-button-danger",3,"click",4,"ngIf"],["pButton","","icon","pi pi-trash","class","p-button-rounded p-button-danger",3,"click",4,"ngIf"],["pInputText","",1,"input-field",3,"ngModelChange","ngModel"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil",1,"p-button-rounded",3,"click"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded","p-button-success",3,"click"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded","p-button-danger",3,"click"],["pButton","","icon","pi pi-trash",1,"p-button-rounded","p-button-danger",3,"click"]],template:function(e,i){e&1&&(I(0,"p-toast"),o(1,"div",0)(2,"h3"),d(3,"A\xF1adir Asegurado"),r(),o(4,"div",1)(5,"label",2),d(6,"Tipo de Sangre"),r(),o(7,"input",3),v("ngModelChange",function(n){return S(i.nuevoAsegurado.tipoSangre,n)||(i.nuevoAsegurado.tipoSangre=n),n}),r()(),o(8,"div",1)(9,"label",4),d(10,"Sexo"),r(),o(11,"input",5),v("ngModelChange",function(n){return S(i.nuevoAsegurado.sexo,n)||(i.nuevoAsegurado.sexo=n),n}),r()(),o(12,"div",1)(13,"label",6),d(14,"Fecha de Nacimiento"),r(),o(15,"p-calendar",7),v("ngModelChange",function(n){return S(i.nuevoAsegurado.fechaNacimiento,n)||(i.nuevoAsegurado.fechaNacimiento=n),n}),r()(),o(16,"div",1)(17,"label",8),d(18,"Usuario"),r(),o(19,"p-dropdown",9),v("ngModelChange",function(n){return S(i.nuevoAsegurado.usuario.id,n)||(i.nuevoAsegurado.usuario.id=n),n}),r()(),o(20,"div",10)(21,"button",11),f("click",function(){return i.addAsegurado()}),r()()(),o(22,"div",12)(23,"p-table",13),C(24,le,15,0,"ng-template",14)(25,be,21,11,"ng-template",15),r()()),e&2&&(u(7),h("ngModel",i.nuevoAsegurado.tipoSangre),u(4),h("ngModel",i.nuevoAsegurado.sexo),u(4),h("ngModel",i.nuevoAsegurado.fechaNacimiento),u(4),c("options",i.usuariosDisponibles),h("ngModel",i.nuevoAsegurado.usuario.id),u(4),c("value",i.asegurados)("tableStyle",R(9,ue))("sortField",i.sortField)("sortOrder",i.sortOrder))},dependencies:[O,B,j,D,F,U,W,oe,Q,L,ie,X,Z,ee,te,ne,re,J,q,Y,K,H,G,z,$],styles:[".asegurado-list-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;overflow-x:auto}.add-asegurado-form[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem}.add-asegurado-form[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}.input-field[_ngcontent-%COMP%], .input-dropdown[_ngcontent-%COMP%], .input-calendar[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a}.input-dropdown[_ngcontent-%COMP%]:focus, .input-field[_ngcontent-%COMP%]:focus, .input-calendar[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.button-container[_ngcontent-%COMP%]{grid-column:1 / -1;display:flex;justify-content:center}.p-button-success[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important;width:40%;font-size:1rem;border-radius:8px;padding:.75rem 0;border:none!important;font-weight:700;transition:background-color .3s ease}.p-button-rounded[_ngcontent-%COMP%]{border-radius:50%!important}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}.p-button-success[_ngcontent-%COMP%]{background-color:#43a047!important;color:#fff!important}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}"]})};export{y as default};
