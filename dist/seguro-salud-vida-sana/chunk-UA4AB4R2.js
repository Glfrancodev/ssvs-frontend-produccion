import{a as me}from"./chunk-MQGP7DR4.js";import{a as Y,b as J}from"./chunk-BNUNU2GP.js";import{a as re,b as ae}from"./chunk-O3KWYK2S.js";import{A as oe,B as ne,d as x,f as G,j as L,k as q,l as U,m as H,n as K,u as Q,v as X,w as Z,x as ee,y as te,z as ie}from"./chunk-RDO4C5ZH.js";import"./chunk-4YRY4IP2.js";import{b as N,d as W,e as A,h as j,j as z}from"./chunk-24563CTF.js";import{a as $}from"./chunk-WURDNOJS.js";import{o as D}from"./chunk-EALBQTKK.js";import{m as V,q as F}from"./chunk-5DWL5JJZ.js";import{$a as f,Ab as c,Cb as w,Eb as h,Fb as P,Gb as C,Hb as O,Ib as R,Jb as y,Na as p,Oa as _,_ as k,a as E,bc as B,cb as u,fb as I,ha as l,hb as a,ia as d,ib as m,jb as T,nb as g,qb as b,rb as s}from"./chunk-3RWLLOHT.js";var ce=()=>({width:"120px",height:"40px"}),pe=()=>({"min-width":"50rem"});function le(i,e){i&1&&(a(0,"tr")(1,"th",12),c(2,"Id"),m(),a(3,"th",13),c(4,"Nombre"),m(),a(5,"th",14),c(6,"Descripci\xF3n"),m(),a(7,"th",15),c(8,"Acci\xF3n"),m()())}function de(i,e){if(i&1&&c(0),i&2){let t=s().$implicit;w(" ",t.id," ")}}function ue(i,e){if(i&1){let t=g();a(0,"input",24),C("ngModelChange",function(n){l(t);let r=s().$implicit;return P(r.nombre,n)||(r.nombre=n),d(n)}),m()}if(i&2){let t=s().$implicit;h("ngModel",t.nombre)}}function ge(i,e){if(i&1&&c(0),i&2){let t=s().$implicit;w(" ",t.nombre," ")}}function _e(i,e){if(i&1){let t=g();a(0,"input",24),C("ngModelChange",function(n){l(t);let r=s().$implicit;return P(r.descripcion,n)||(r.descripcion=n),d(n)}),m()}if(i&2){let t=s().$implicit;h("ngModel",t.descripcion)}}function fe(i,e){if(i&1&&c(0),i&2){let t=s().$implicit;w(" ",t.descripcion," ")}}function be(i,e){if(i&1){let t=g();a(0,"button",25),b("click",function(){l(t);let n=s().$implicit,r=s();return d(r.onRowEditInit(n))}),m()}}function he(i,e){if(i&1){let t=g();a(0,"button",26),b("click",function(){l(t);let n=s().$implicit,r=s();return d(r.deletePermiso(n.id))}),m()}}function Pe(i,e){if(i&1){let t=g();a(0,"button",27),b("click",function(){l(t);let n=s().$implicit,r=s();return d(r.onRowEditSave(n))}),m()}}function Ce(i,e){if(i&1){let t=g();a(0,"button",28),b("click",function(){l(t);let n=s(),r=n.$implicit,v=n.rowIndex,S=s();return d(S.onRowEditCancel(r,v))}),m()}}function we(i,e){if(i&1&&(a(0,"tr",16)(1,"td")(2,"p-cellEditor"),f(3,de,1,1,"ng-template",17),m()(),a(4,"td")(5,"p-cellEditor"),f(6,ue,1,1,"ng-template",18)(7,ge,1,1,"ng-template",17),m()(),a(8,"td")(9,"p-cellEditor"),f(10,_e,1,1,"ng-template",18)(11,fe,1,1,"ng-template",17),m()(),a(12,"td")(13,"div",19),f(14,be,1,0,"button",20)(15,he,1,0,"button",21)(16,Pe,1,0,"button",22)(17,Ce,1,0,"button",23),m()()()),i&2){let t=e.$implicit,o=e.editing;u("pEditableRow",t),p(14),u("ngIf",!o),p(),u("ngIf",!o),p(),u("ngIf",o),p(),u("ngIf",o)}}var M=class i{constructor(e,t,o,n,r){this.permisoService=e;this.messageService=t;this.bitacoraService=o;this.authService=n;this.cdr=r}permisos=[];editedPermisos={};newPermiso={nombre:"",descripcion:""};sortField="id";sortOrder=1;ngOnInit(){this.getAllPermisos()}getAllPermisos(){this.permisoService.getPermisos().subscribe(e=>{this.permisos=e})}registrarBitacora(e,t){this.bitacoraService.getUserIP().subscribe({next:o=>{let n=new Date,r=`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`,v=`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}:${n.getSeconds().toString().padStart(2,"0")}`,S={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:r,hora:v,ip:o.ip,accion:e,detalle:t};this.bitacoraService.createBitacora(S).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:se=>console.error("Error al registrar en bit\xE1cora",se)})},error:o=>console.error("Error al obtener IP",o)})}onRowEditInit(e){this.editedPermisos[e.id]=E({},e),this.messageService.add({severity:"info",summary:"Edici\xF3n",detail:"Editando permiso"})}onRowEditSave(e){e.nombre&&e.descripcion?this.permisoService.updatePermiso(e).subscribe(()=>{delete this.editedPermisos[e.id],this.messageService.add({severity:"success",summary:"Guardado",detail:"Permiso actualizado"}),this.registrarBitacora("Editar Permiso",`Permiso actualizado: ${e.nombre}`)}):this.messageService.add({severity:"error",summary:"Error",detail:"Nombre y descripci\xF3n son obligatorios"})}onRowEditCancel(e,t){this.permisos[t]=this.editedPermisos[e.id]||e,delete this.editedPermisos[e.id],this.messageService.add({severity:"info",summary:"Cancelado",detail:"Edici\xF3n cancelada"})}deletePermiso(e){let t=this.permisos.find(o=>o.id===e);this.permisoService.deletePermiso(e).subscribe(()=>{this.permisos=this.permisos.filter(o=>o.id!==e),this.messageService.add({severity:"success",summary:"Eliminado",detail:"Permiso eliminado correctamente"}),this.registrarBitacora("Eliminar Permiso",`Permiso eliminado: ${t?.nombre}`)})}savePermiso(){this.newPermiso.nombre&&this.newPermiso.descripcion?this.permisoService.createPermiso(this.newPermiso).subscribe(e=>{this.permisos=[...this.permisos,e],this.cdr.detectChanges(),this.messageService.add({severity:"success",summary:"Guardado",detail:"Nuevo permiso creado correctamente"}),this.registrarBitacora("A\xF1adir Permiso",`Permiso a\xF1adido: ${e.nombre}`),this.newPermiso={nombre:"",descripcion:""}}):this.messageService.add({severity:"error",summary:"Error",detail:"Nombre y descripci\xF3n son obligatorios"})}static \u0275fac=function(t){return new(t||i)(_(me),_(x),_($),_(D),_(B))};static \u0275cmp=k({type:i,selectors:[["app-permiso"]],standalone:!0,features:[O([x]),R],decls:18,vars:10,consts:[[1,"form-container"],[2,"font-weight","bold"],[1,"form-field"],["for","nombre",2,"font-weight","bold"],["id","nombre","type","text","pInputText","","placeholder","Nombre del permiso",3,"ngModelChange","ngModel"],["for","descripcion",2,"font-weight","bold"],["id","descripcion","type","text","pInputText","","placeholder","Descripci\xF3n del permiso",3,"ngModelChange","ngModel"],[1,"form-field",2,"text-align","center"],["icon","pi pi-save","label","Guardar","styleClass","p-button-raised p-button-warning",3,"click"],["dataKey","id","editMode","row",3,"value","tableStyle","sortField","sortOrder"],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","id",2,"width","10%"],[2,"width","30%"],[2,"width","40%"],[2,"width","20%"],[3,"pEditableRow"],["pTemplate","output"],["pTemplate","input"],[1,"flex","align-items-center","justify-content-center","gap-2"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil","class","p-button-rounded","style","background-color: #ffffff; color: #007bff; border: none; width: 2.5rem; height: 2.5rem;",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","icon","pi pi-trash","class","p-button-rounded p-button-danger","style","width: 3rem; height: 3rem;",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded","style","background-color: #ffffff; color: #28a745; border: none; width: 2.5rem; height: 2.5rem; margin-right: 0.5rem;",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded","style","background-color: #ffffff; color: #dc3545; border: none; width: 2.5rem; height: 2.5rem;",3,"click",4,"ngIf"],["pInputText","","type","text","required","",3,"ngModelChange","ngModel"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil",1,"p-button-rounded",2,"background-color","#ffffff","color","#007bff","border","none","width","2.5rem","height","2.5rem",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-trash",1,"p-button-rounded","p-button-danger",2,"width","3rem","height","3rem",3,"click"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded",2,"background-color","#ffffff","color","#28a745","border","none","width","2.5rem","height","2.5rem","margin-right","0.5rem",3,"click"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded",2,"background-color","#ffffff","color","#dc3545","border","none","width","2.5rem","height","2.5rem",3,"click"]],template:function(t,o){t&1&&(T(0,"p-toast"),a(1,"div",0)(2,"h3",1),c(3,"Crear Nuevo Permiso"),m(),a(4,"div",2)(5,"label",3),c(6,"Nombre"),m(),a(7,"input",4),C("ngModelChange",function(r){return P(o.newPermiso.nombre,r)||(o.newPermiso.nombre=r),r}),m()(),a(8,"div",2)(9,"label",5),c(10,"Descripci\xF3n"),m(),a(11,"input",6),C("ngModelChange",function(r){return P(o.newPermiso.descripcion,r)||(o.newPermiso.descripcion=r),r}),m()(),a(12,"div",7)(13,"p-button",8),b("click",function(){return o.savePermiso()}),m()()(),a(14,"p-table",9),c(15,"> "),f(16,le,9,0,"ng-template",10)(17,we,18,5,"ng-template",11),m()),t&2&&(p(7),h("ngModel",o.newPermiso.nombre),p(4),h("ngModel",o.newPermiso.descripcion),p(2),I(y(8,ce)),p(),u("value",o.permisos)("tableStyle",y(9,pe))("sortField",o.sortField)("sortOrder",o.sortOrder))},dependencies:[ne,Q,G,X,oe,Z,ee,te,ie,F,V,ae,re,z,N,W,j,A,K,U,H,q,L,J,Y],styles:[".form-container[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #ddd;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:100%;margin:auto}.form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}input[pInputText][_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a;transition:border-color .3s ease}input[pInputText][_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.p-button-warning[_ngcontent-%COMP%]{background-color:#ffc107!important;color:#fff!important;font-size:1rem;border-radius:8px;padding:.75rem 1rem;font-weight:700;width:100%;max-width:150px;margin:auto;box-shadow:0 2px 6px #00000026}.p-button-warning[_ngcontent-%COMP%]:hover{background-color:#e0a800!important}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:auto;border-radius:8px;overflow:hidden;box-shadow:0 4px 8px #0000001a;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}.p-button-rounded[_ngcontent-%COMP%]{border-radius:50%!important}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}.p-button-success[_ngcontent-%COMP%]{background-color:#43a047!important;color:#fff!important}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}"]})};export{M as default};
