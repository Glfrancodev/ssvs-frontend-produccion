import{a as ee}from"./chunk-VSSQ573Q.js";import{a as ie}from"./chunk-3CYC4MS3.js";import{a as oe}from"./chunk-DAOLN32H.js";import{a as te}from"./chunk-LQ655H6I.js";import{a as Q}from"./chunk-3MQHXZD4.js";import{a as K}from"./chunk-7GE6MY6T.js";import{a as X,b as Y}from"./chunk-FNNVKIP6.js";import{b as Z}from"./chunk-ZIVYLMDF.js";import{A as q,B as U,H as J,h as L,p as W,q as z,s as j,x as $,y as G}from"./chunk-F5T2E34X.js";import{o as V,s as F,t as N,y as B}from"./chunk-RO5PIZCY.js";import"./chunk-4YRY4IP2.js";import{m as A,p as D,r as k}from"./chunk-2HP4KZBQ.js";import{$a as p,Bb as M,Cb as x,Db as S,Fb as H,Ka as s,La as m,Pb as R,Qb as T,X as O,Ya as v,ea as f,eb as r,fa as _,fb as n,kb as C,nb as h,ob as l,xb as c,yb as b,zb as I}from"./chunk-TOSOZOFE.js";import{a as P,b as y}from"./chunk-ODN5LVDJ.js";function re(d,t){if(d&1){let e=C();r(0,"div",1)(1,"label",6),c(2,"M\xE9dico"),n(),r(3,"p-dropdown",7),S("ngModelChange",function(a){f(e);let i=l();return x(i.selectedMedico,a)||(i.selectedMedico=a),_(a)}),h("onChange",function(){f(e);let a=l();return _(a.onMedicoChange())}),n()()}if(d&2){let e=l();s(3),p("options",e.medicos),M("ngModel",e.selectedMedico)}}function ae(d,t){if(d&1){let e=C();r(0,"div",1)(1,"label",8),c(2,"Horario"),n(),r(3,"p-dropdown",9),S("ngModelChange",function(a){f(e);let i=l();return x(i.selectedHorario,a)||(i.selectedHorario=a),_(a)}),h("onChange",function(){f(e);let a=l();return _(a.onHorarioChange())}),n()()}if(d&2){let e=l();s(3),p("options",e.horarios),M("ngModel",e.selectedHorario)}}function de(d,t){d&1&&(r(0,"tr")(1,"th",14),c(2,"N\xFAmero"),n(),r(3,"th"),c(4,"Fecha Reservada"),n(),r(5,"th"),c(6,"Hora"),n(),r(7,"th"),c(8,"Estado"),n(),r(9,"th"),c(10,"Asegurado"),n(),r(11,"th"),c(12,"Acci\xF3n"),n()())}function ce(d,t){if(d&1){let e=C();r(0,"button",16),h("click",function(){f(e);let a=l().$implicit,i=l(2);return _(i.reservarCupo(a))}),n()}}function se(d,t){if(d&1&&(r(0,"tr")(1,"td"),c(2),n(),r(3,"td"),c(4),R(5,"date"),n(),r(6,"td"),c(7),n(),r(8,"td"),c(9),n(),r(10,"td"),c(11),n(),r(12,"td"),v(13,ce,1,0,"button",15),n()()),d&2){let e=t.$implicit;s(2),b(e.numero),s(2),b(e.fechaReservado?T(5,6,e.fechaReservado,"dd/MM/yyyy"):"No reservada"),s(3),b(e.hora),s(2),b(e.estado),s(2),I(" ",e.asegurado?e.asegurado.usuario.nombre+" "+e.asegurado.usuario.apellido:"Sin asegurado"," "),s(2),p("ngIf",e.estado==="Libre")}}function le(d,t){if(d&1&&(r(0,"div",10)(1,"h3"),c(2,"Cupos Disponibles"),n(),r(3,"p-table",11),v(4,de,13,0,"ng-template",12)(5,se,14,9,"ng-template",13),n()()),d&2){let e=l();s(3),p("value",e.cupos)("sortField","id")("sortOrder",1)}}var w=class d{constructor(t,e,o,a,i,u,E){this.especialidadService=t;this.medicoEspecialidadService=e;this.horarioService=o;this.cupoService=a;this.aseguradoService=i;this.authService=u;this.medicoService=E}especialidades=[];horarios=[];cupos=[];selectedEspecialidad=null;selectedMedico=null;selectedMedicoEspecialidad;selectedHorario=null;medicos=[];ngOnInit(){this.obtenerEspecialidades()}obtenerEspecialidades(){this.especialidadService.getEspecialidades().subscribe(t=>{this.especialidades=t})}onEspecialidadChange(){this.selectedEspecialidad&&this.selectedEspecialidad.id!==void 0?this.obtenerMedicosPorEspecialidad(this.selectedEspecialidad.id):this.medicos=[]}obtenerMedicosPorEspecialidad(t){this.medicoEspecialidadService.getMedicoEspecialidades().subscribe(e=>{let o=[],a=e.filter(i=>i.especialidad.id===t&&i.medico!==void 0).map(i=>{let u=i.medico.id,E=`${i.medico.usuario.nombre} ${i.medico.usuario.apellido}`;return this.medicoService.obtenerPromedioCalificaciones(u).toPromise().then(g=>{let ne=g!=null?`${g.toFixed(1)} \u2605`:"-";o.push({id:u,nombreCompleto:`${E} - ${ne}`})}).catch(g=>{g.status===404?(console.warn(`No se encontr\xF3 calificaci\xF3n para el m\xE9dico con ID ${u}, se colocar\xE1 "-" por defecto.`),o.push({id:u,nombreCompleto:`${E} - Sin calificaciones`})):console.error(`Error al obtener la calificaci\xF3n del m\xE9dico con ID ${u}:`,g)})});Promise.all(a).then(()=>{this.medicos=o}).catch(i=>{console.error("Error al cargar las calificaciones de los m\xE9dicos:",i)})})}onMedicoChange(){this.selectedEspecialidad?.id!==void 0&&this.selectedMedico?.id!==void 0?this.medicoEspecialidadService.getMedicoEspecialidadByEspecialidadAndMedico(this.selectedEspecialidad.id,this.selectedMedico.id).subscribe(t=>{this.selectedMedicoEspecialidad=t,this.obtenerHorariosPorMedicoEspecialidad(this.selectedMedicoEspecialidad.id)}):this.selectedMedicoEspecialidad=null}obtenerHorariosPorMedicoEspecialidad(t){this.horarioService.getHorariosPorMedicoEspecialidad(t).subscribe(e=>{this.horarios=e.map(o=>y(P({},o),{formattedLabel:`${o.fecha} - ${o.horaInicio} a ${o.horaFinal}`}))})}obtenerCuposPorHorario(t){this.cupoService.getCuposPorHorario(t).subscribe(e=>{this.cupos=e})}onHorarioChange(){this.selectedHorario&&this.selectedHorario.id?this.obtenerCuposPorHorario(this.selectedHorario.id):this.cupos=[]}reservarCupo(t){let e=this.authService.getAuthenticatedUserEmail();e?this.aseguradoService.getAseguradoPorCorreo(e).subscribe(o=>{let a={numero:t.numero,fechaReservado:new Date().toISOString().split("T")[0],estado:"Ocupado",horario:t.horario,asegurado:{id:o.id}};t.id!==void 0?this.cupoService.reservarCupo(t.id,a).subscribe(i=>{console.log("Reserva realizada exitosamente:",i),this.obtenerCuposPorHorario(this.selectedHorario.id)},i=>{console.error("Error al actualizar el cupo:",i)}):console.error("El ID del cupo es undefined. No se puede actualizar el cupo.")},o=>{console.error("Error al obtener el asegurado por correo:",o)}):console.error("No se pudo obtener el correo del asegurado.")}static \u0275fac=function(e){return new(e||d)(m(ee),m(oe),m(ie),m(te),m(K),m(V),m(Q))};static \u0275cmp=O({type:d,selectors:[["app-reserva"]],standalone:!0,features:[H],decls:10,vars:5,consts:[[1,"form-container","add-usuario-form"],[1,"form-field"],["for","especialidad"],["optionLabel","nombre","placeholder","Seleccione una especialidad",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],["class","form-field",4,"ngIf"],["class","cupo-table",4,"ngIf"],["for","medico"],["optionLabel","nombreCompleto","placeholder","Seleccione un m\xE9dico",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],["for","horario"],["placeholder","Seleccione un horario","optionLabel","formattedLabel",1,"input-dropdown",3,"ngModelChange","onChange","options","ngModel"],[1,"cupo-table"],[3,"value","sortField","sortOrder"],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","id"],["pButton","","type","button","label","Reservar","class","p-button-success",3,"click",4,"ngIf"],["pButton","","type","button","label","Reservar",1,"p-button-success",3,"click"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"h3"),c(2,"Seleccione Especialidad, M\xE9dico y Horario"),n(),r(3,"div",1)(4,"label",2),c(5,"Especialidad"),n(),r(6,"p-dropdown",3),S("ngModelChange",function(i){return x(o.selectedEspecialidad,i)||(o.selectedEspecialidad=i),i}),h("onChange",function(){return o.onEspecialidadChange()}),n()(),v(7,re,4,2,"div",4)(8,ae,4,2,"div",4),n(),v(9,le,6,3,"div",5)),e&2&&(s(6),p("options",o.especialidades),M("ngModel",o.selectedEspecialidad),s(),p("ngIf",o.medicos.length>0),s(),p("ngIf",o.horarios.length>0),s(),p("ngIf",o.cupos.length>0))},dependencies:[k,A,D,Z,L,G,$,J,q,U,B,F,N,j,z,W,Y,X],styles:[".usuario-list-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;overflow-x:auto}.form-container.add-usuario-form[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem}.form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.6rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333}.input-dropdown[_ngcontent-%COMP%], .input-field[_ngcontent-%COMP%]{width:100%;max-width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a}.input-dropdown[_ngcontent-%COMP%]:focus, .input-field[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.cupo-table[_ngcontent-%COMP%]{width:100%;max-width:100%;padding:1rem;border-radius:12px;background-color:#fff;box-shadow:0 4px 8px #0000001a;margin-top:1.5rem}.p-table[_ngcontent-%COMP%]{width:100%;border-radius:8px;overflow:hidden;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:12px;text-align:center;font-weight:700}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:center;vertical-align:middle}.p-button-success[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important;border:none!important;border-radius:8px!important;padding:.5rem 1rem;font-weight:700;transition:background-color .3s ease}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}.cupo-table[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}"]})};export{w as default};
