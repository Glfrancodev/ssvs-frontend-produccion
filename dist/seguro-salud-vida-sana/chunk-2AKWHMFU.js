import{a as pe}from"./chunk-UMRBCVWM.js";import{a as ce}from"./chunk-2NNJV3TI.js";import{a as J,b as Q}from"./chunk-7ZVYFVUR.js";import{a as le,b as se}from"./chunk-434S2MCI.js";import{A as re,B as ae,d as S,f as z,j as G,k as H,l as K,m as Y,n as q,s as X,t as Z,u as ee,w as te,x as ie,y as oe,z as ne}from"./chunk-WB7R4CTM.js";import{b as $,d as N,e as F,j}from"./chunk-TCU2USIY.js";import"./chunk-4YRY4IP2.js";import{a as L}from"./chunk-B77IM2LF.js";import{o as D}from"./chunk-OAPWJZOF.js";import{k as B,m as W,q as V}from"./chunk-4YUBQKU5.js";import{Ab as d,Bb as u,Cb as m,Db as R,Eb as k,Fb as O,Ja as c,Ka as h,W as P,Xa as b,Zb as A,_a as g,da as _,db as a,ea as f,eb as l,fb as T,jb as C,mb as x,nb as s,wb as p,xb as w,yb as y}from"./chunk-VM3UWR7T.js";import{a as U,b as I}from"./chunk-ODN5LVDJ.js";var ue=()=>({"min-width":"50rem","max-width":"100%"});function me(t,i){t&1&&(a(0,"tr")(1,"th",20),p(2,"ID"),l(),a(3,"th",21),p(4,"Correo"),l(),a(5,"th",22),p(6,"Nombre"),l(),a(7,"th",22),p(8,"Apellido"),l(),a(9,"th",20),p(10,"Estado"),l(),a(11,"th",22),p(12,"Rol"),l(),a(13,"th",22),p(14,"Acciones"),l()())}function ge(t,i){if(t&1&&p(0),t&2){let e=s().$implicit;y(" ",e.id," ")}}function _e(t,i){if(t&1&&p(0),t&2){let e=s().$implicit;y(" ",e.id," ")}}function fe(t,i){if(t&1&&p(0),t&2){let e=s().$implicit;w(e.correo)}}function be(t,i){if(t&1){let e=C();a(0,"input",31),m("ngModelChange",function(r){_(e);let o=s().$implicit;return u(o.correo,r)||(o.correo=r),f(r)}),l()}if(t&2){let e=s().$implicit;d("ngModel",e.correo)}}function Ce(t,i){if(t&1&&p(0),t&2){let e=s().$implicit;w(e.nombre)}}function he(t,i){if(t&1){let e=C();a(0,"input",31),m("ngModelChange",function(r){_(e);let o=s().$implicit;return u(o.nombre,r)||(o.nombre=r),f(r)}),l()}if(t&2){let e=s().$implicit;d("ngModel",e.nombre)}}function we(t,i){if(t&1&&p(0),t&2){let e=s().$implicit;w(e.apellido)}}function xe(t,i){if(t&1){let e=C();a(0,"input",31),m("ngModelChange",function(r){_(e);let o=s().$implicit;return u(o.apellido,r)||(o.apellido=r),f(r)}),l()}if(t&2){let e=s().$implicit;d("ngModel",e.apellido)}}function ve(t,i){if(t&1&&p(0),t&2){let e=s().$implicit;w(e.estaActivo?"Activo":"Inactivo")}}function Se(t,i){if(t&1&&p(0),t&2){let e=s().$implicit;w(e.estaActivo?"Activo":"Inactivo")}}function Me(t,i){if(t&1&&p(0),t&2){let e=s().$implicit;w(e.rol==null?null:e.rol.nombre)}}function Ue(t,i){if(t&1){let e=C();a(0,"p-dropdown",32),m("ngModelChange",function(r){_(e);let o=s().$implicit;return u(o.rol.id,r)||(o.rol.id=r),f(r)}),l()}if(t&2){let e=s().$implicit,n=s();g("options",n.roles),d("ngModel",e.rol.id)}}function ye(t,i){if(t&1){let e=C();a(0,"button",33),x("click",function(){_(e);let r=s().$implicit,o=s();return f(o.onRowEditInit(r))}),l()}}function Ee(t,i){if(t&1){let e=C();a(0,"button",34),x("click",function(){_(e);let r=s().$implicit,o=s();return f(o.toggleEstadoUsuario(r))}),l()}if(t&2){let e=s().$implicit;g("ngClass",e.estaActivo?"p-button-danger":"p-button-success")}}function Ie(t,i){if(t&1){let e=C();a(0,"button",35),x("click",function(){_(e);let r=s().$implicit,o=s();return f(o.onRowEditSave(r))}),l()}}function Pe(t,i){if(t&1){let e=C();a(0,"button",36),x("click",function(){_(e);let r=s(),o=r.$implicit,v=r.rowIndex,M=s();return f(M.onRowEditCancel(o,v))}),l()}}function Te(t,i){if(t&1&&(a(0,"tr",23)(1,"td")(2,"p-cellEditor"),b(3,ge,1,1,"ng-template",24)(4,_e,1,1,"ng-template",25),l()(),a(5,"td")(6,"p-cellEditor"),b(7,fe,1,1,"ng-template",24)(8,be,1,1,"ng-template",25),l()(),a(9,"td")(10,"p-cellEditor"),b(11,Ce,1,1,"ng-template",24)(12,he,1,1,"ng-template",25),l()(),a(13,"td")(14,"p-cellEditor"),b(15,we,1,1,"ng-template",24)(16,xe,1,1,"ng-template",25),l()(),a(17,"td")(18,"p-cellEditor"),b(19,ve,1,1,"ng-template",24)(20,Se,1,1,"ng-template",25),l()(),a(21,"td")(22,"p-cellEditor"),b(23,Me,1,1,"ng-template",24)(24,Ue,1,2,"ng-template",25),l()(),a(25,"td")(26,"div",26),b(27,ye,1,0,"button",27)(28,Ee,1,1,"button",28)(29,Ie,1,0,"button",29)(30,Pe,1,0,"button",30),l()()()),t&2){let e=i.$implicit,n=i.editing;g("pEditableRow",e),c(27),g("ngIf",!n),c(),g("ngIf",!n),c(),g("ngIf",n),c(),g("ngIf",n)}}var E=class t{constructor(i,e,n,r,o,v){this.usuarioService=i;this.rolService=e;this.messageService=n;this.cdr=r;this.bitacoraService=o;this.authService=v}usuarios=[];roles=[];editedUsuarios={};estadoOptions=[{label:"Activo",value:!0},{label:"Inactivo",value:!1}];newUsuario={ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0,rol:{id:0,nombre:""}};ngOnInit(){this.getAllUsuarios(),this.getAllRoles()}registrarBitacora(i,e){this.bitacoraService.getUserIP().subscribe({next:n=>{let r=new Date,o=`${r.getFullYear()}-${(r.getMonth()+1).toString().padStart(2,"0")}-${r.getDate().toString().padStart(2,"0")}`,v=`${r.getHours().toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")}:${r.getSeconds().toString().padStart(2,"0")}`,M={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:o,hora:v,ip:n.ip,accion:i,detalle:e};this.bitacoraService.createBitacora(M).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:de=>console.error("Error al registrar en bit\xE1cora",de)})},error:n=>console.error("Error al obtener IP",n)})}getAllUsuarios(){this.usuarioService.getUsuarios().subscribe(i=>{this.usuarios=i,this.sortUsuarios()})}getAllRoles(){this.rolService.getRoles().subscribe(i=>{this.roles=i})}sortUsuarios(){this.usuarios.sort((i,e)=>(i.id||0)-(e.id||0))}onRowEditInit(i){this.editedUsuarios[i.id]=U({},i),this.messageService.add({severity:"info",summary:"Edici\xF3n",detail:"Editando usuario"})}onRowEditSave(i){this.usuarioService.updateUsuario(i).subscribe(()=>{delete this.editedUsuarios[i.id],this.messageService.add({severity:"success",summary:"Guardado",detail:"Usuario actualizado"}),this.registrarBitacora("Editar usuario",`Usuario editado: ${i.correo}`),this.getAllUsuarios()})}onRowEditCancel(i,e){this.usuarios[e]=this.editedUsuarios[i.id]||i,delete this.editedUsuarios[i.id],this.messageService.add({severity:"info",summary:"Cancelado",detail:"Edici\xF3n cancelada"})}toggleEstadoUsuario(i){let e=I(U({},i),{estaActivo:!i.estaActivo});this.usuarioService.updateUsuario(e).subscribe(()=>{i.estaActivo=!i.estaActivo,this.sortUsuarios(),this.messageService.add({severity:"success",summary:i.estaActivo?"Activado":"Desactivado",detail:`Usuario ${i.estaActivo?"activado":"desactivado"} correctamente`});let n=i.estaActivo?"Activar usuario":"Desactivar usuario";this.registrarBitacora(n,`Usuario ${n.toLowerCase()}: ${i.correo}`)})}addUsuario(){this.usuarioService.createUsuario(this.newUsuario).subscribe(i=>{this.getAllUsuarios(),this.messageService.add({severity:"success",summary:"Usuario Agregado",detail:"Nuevo usuario creado correctamente"}),this.registrarBitacora("A\xF1adir usuario",`Usuario creado: ${i.correo}`),this.newUsuario={ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!1,rol:{id:0,nombre:""}}})}static \u0275fac=function(e){return new(e||t)(h(pe),h(ce),h(S),h(A),h(L),h(D))};static \u0275cmp=P({type:t,selectors:[["app-usuario"]],standalone:!0,features:[R([S]),k],decls:34,vars:10,consts:[[1,"usuario-list-container"],[1,"add-usuario-form"],[2,"font-weight","bold"],[1,"form-field"],["for","ci"],["id","ci","type","text","pInputText","","placeholder","Ingrese CI",3,"ngModelChange","ngModel"],["for","correo"],["id","correo","type","email","pInputText","","placeholder","Ingrese Correo",3,"ngModelChange","ngModel"],["for","contrasena"],["id","contrasena","type","password","pInputText","","placeholder","Ingrese Contrase\xF1a",3,"ngModelChange","ngModel"],["for","nombre"],["id","nombre","type","text","pInputText","","placeholder","Ingrese Nombre",3,"ngModelChange","ngModel"],["for","apellido"],["id","apellido","type","text","pInputText","","placeholder","Ingrese Apellido",3,"ngModelChange","ngModel"],["for","rol"],["id","rol","optionLabel","nombre","optionValue","id","placeholder","Seleccione Rol",3,"ngModelChange","options","ngModel"],["label","A\xF1adir Usuario","icon","pi pi-plus","styleClass","p-button-raised p-button-success",3,"click"],["dataKey","id","editMode","row",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"width","10%"],[2,"width","20%"],[2,"width","15%"],[3,"pEditableRow"],["pTemplate","output"],["pTemplate","input"],[1,"flex","align-items-center","justify-content-center","gap-2"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil","class","p-button-rounded action-button","style","background-color: #ffffff; color: #007bff; border: none; width: 2rem; height: 2rem;",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","icon","pi pi-ban","class","p-button-rounded action-button",3,"ngClass","click",4,"ngIf"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded action-button","style","background-color: #ffffff; color: #28a745; border: none; width: 2rem; height: 2rem; margin-right: 0.3rem;",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded action-button","style","background-color: #ffffff; color: #dc3545; border: none; width: 2rem; height: 2rem;",3,"click",4,"ngIf"],["pInputText","","type","text",1,"input-field",3,"ngModelChange","ngModel"],["optionLabel","nombre","optionValue","id","placeholder","Seleccione rol",1,"input-dropdown",3,"ngModelChange","options","ngModel"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil",1,"p-button-rounded","action-button",2,"background-color","#ffffff","color","#007bff","border","none","width","2rem","height","2rem",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-ban",1,"p-button-rounded","action-button",3,"click","ngClass"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded","action-button",2,"background-color","#ffffff","color","#28a745","border","none","width","2rem","height","2rem","margin-right","0.3rem",3,"click"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded","action-button",2,"background-color","#ffffff","color","#dc3545","border","none","width","2rem","height","2rem",3,"click"]],template:function(e,n){e&1&&(T(0,"p-toast"),a(1,"div",0)(2,"div",1)(3,"h3",2),p(4,"A\xF1adir Nuevo Usuario"),l(),a(5,"div",3)(6,"label",4),p(7,"CI"),l(),a(8,"input",5),m("ngModelChange",function(o){return u(n.newUsuario.ci,o)||(n.newUsuario.ci=o),o}),l()(),a(9,"div",3)(10,"label",6),p(11,"Correo"),l(),a(12,"input",7),m("ngModelChange",function(o){return u(n.newUsuario.correo,o)||(n.newUsuario.correo=o),o}),l()(),a(13,"div",3)(14,"label",8),p(15,"Contrase\xF1a"),l(),a(16,"input",9),m("ngModelChange",function(o){return u(n.newUsuario.contrasena,o)||(n.newUsuario.contrasena=o),o}),l()(),a(17,"div",3)(18,"label",10),p(19,"Nombre"),l(),a(20,"input",11),m("ngModelChange",function(o){return u(n.newUsuario.nombre,o)||(n.newUsuario.nombre=o),o}),l()(),a(21,"div",3)(22,"label",12),p(23,"Apellido"),l(),a(24,"input",13),m("ngModelChange",function(o){return u(n.newUsuario.apellido,o)||(n.newUsuario.apellido=o),o}),l()(),a(25,"div",3)(26,"label",14),p(27,"Rol"),l(),a(28,"p-dropdown",15),m("ngModelChange",function(o){return u(n.newUsuario.rol.id,o)||(n.newUsuario.rol.id=o),o}),l()(),a(29,"div",3)(30,"p-button",16),x("click",function(){return n.addUsuario()}),l()()(),a(31,"p-table",17),b(32,me,15,0,"ng-template",18)(33,Te,31,5,"ng-template",19),l()()),e&2&&(c(8),d("ngModel",n.newUsuario.ci),c(4),d("ngModel",n.newUsuario.correo),c(4),d("ngModel",n.newUsuario.contrasena),c(4),d("ngModel",n.newUsuario.nombre),c(4),d("ngModel",n.newUsuario.apellido),c(4),g("options",n.roles),d("ngModel",n.newUsuario.rol.id),c(3),g("value",n.usuarios)("tableStyle",O(9,ue)))},dependencies:[se,le,z,ae,ee,re,te,ie,oe,ne,V,B,W,j,$,N,F,q,K,Y,H,G,Q,J,Z,X],styles:[".usuario-list-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;overflow-x:auto}.add-usuario-form[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #ddd;border-radius:8px;margin-bottom:2rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;box-shadow:0 2px 8px #00000026}.add-usuario-form[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;margin:0;font-size:1.8rem;color:#3f51b5;text-align:center;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;color:#555;margin-bottom:.2rem}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-dropdown[_ngcontent-%COMP%]{width:100%;padding:.6rem;border-radius:6px;border:1px solid #ddd;box-shadow:inset 0 1px 2px #0000001a;transition:border-color .3s ease}.input-dropdown[_ngcontent-%COMP%]{padding:.6rem;font-size:1rem;background-color:#fff}.input-dropdown[_ngcontent-%COMP%]:hover, .input-dropdown[_ngcontent-%COMP%]:focus{border-color:#3f51b5}.p-button-success[_ngcontent-%COMP%]{width:100%;height:3rem;font-size:1rem;border-radius:8px;background-color:#3f51b5!important;border:none;color:#fff!important;transition:background-color .3s ease}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#2c3e9e!important}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:0 auto;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #00000026}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9f9f9}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e3f2fd}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.p-cellEditor[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .p-cellEditor[_ngcontent-%COMP%]   .p-dropdown[_ngcontent-%COMP%]{width:100%!important;max-width:150px;box-sizing:border-box}.action-button[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;display:flex;align-items:center;justify-content:center;border-radius:50%;border:none!important}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}.p-button-success[_ngcontent-%COMP%]{background-color:#43a047!important;color:#fff!important}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}.p-button-rounded[_ngcontent-%COMP%]{border-radius:50%!important}"]})};export{E as default};
