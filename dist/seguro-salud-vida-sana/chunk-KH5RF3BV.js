import{a as se}from"./chunk-64ACLIH3.js";import{a as ae}from"./chunk-UHJOG3IU.js";import{a as re,b as ne}from"./chunk-LWIABAKO.js";import{A as Q,C as X,D as Z,E as ee,F as te,G as oe,H as ie,d as C,h as L,o as $,p as z,q as H,s as G,u as K,v as Y,x as q,y as J}from"./chunk-5RHHIFSU.js";import{b as V,d as F,e as W,i as U,j}from"./chunk-W5NNSEVP.js";import"./chunk-4YRY4IP2.js";import{a as N}from"./chunk-S2R25WKX.js";import{o as D}from"./chunk-V6WZIOIM.js";import{m as R,r as O}from"./chunk-2HP4KZBQ.js";import{$a as c,Ab as T,Bb as h,Cb as S,Db as v,Eb as k,Fb as P,Gb as B,Ka as u,La as g,X as M,Ya as A,ea as p,eb as i,fa as m,fb as r,gb as I,kb as _,nb as f,ob as l,xb as d,yb as b}from"./chunk-TOSOZOFE.js";import{a as E}from"./chunk-ODN5LVDJ.js";var ue=()=>({"min-width":"50rem","max-width":"100%"});function le(s,e){s&1&&(i(0,"tr")(1,"th",16),d(2,"ID"),r(),i(3,"th",17),d(4,"Tipo de Sangre"),r(),i(5,"th",16),d(6,"Sexo"),r(),i(7,"th",18),d(8,"Fecha de Nacimiento"),r(),i(9,"th",19),d(10,"Nombre Completo"),r(),i(11,"th",20),d(12,"Id Historia"),r(),i(13,"th",16),d(14,"Acci\xF3n"),r()())}function ce(s,e){if(s&1&&d(0),s&2){let t=l().$implicit;b(t.tipoSangre)}}function pe(s,e){if(s&1){let t=_();i(0,"input",29),v("ngModelChange",function(a){p(t);let n=l().$implicit;return S(n.tipoSangre,a)||(n.tipoSangre=a),m(a)}),r()}if(s&2){let t=l().$implicit;h("ngModel",t.tipoSangre)}}function me(s,e){if(s&1){let t=_();i(0,"button",30),f("click",function(){p(t);let a=l().$implicit,n=l();return m(n.onRowEditInit(a))}),r()}}function ge(s,e){if(s&1){let t=_();i(0,"button",31),f("click",function(){p(t);let a=l().$implicit,n=l();return m(n.onRowEditSave(a))}),r()}}function _e(s,e){if(s&1){let t=_();i(0,"button",32),f("click",function(){p(t);let a=l(),n=a.$implicit,x=a.rowIndex,w=l();return m(w.onRowEditCancel(n,x))}),r()}}function fe(s,e){if(s&1){let t=_();i(0,"button",33),f("click",function(){p(t);let a=l().$implicit,n=l();return m(n.deleteAsegurado(a.id))}),r()}}function be(s,e){if(s&1&&(i(0,"tr",21)(1,"td"),d(2),r(),i(3,"td")(4,"p-cellEditor"),A(5,ce,1,1,"ng-template",22)(6,pe,1,1,"ng-template",23),r()(),i(7,"td"),d(8),r(),i(9,"td"),d(10),r(),i(11,"td"),d(12),r(),i(13,"td"),d(14),r(),i(15,"td")(16,"div",24),A(17,me,1,0,"button",25)(18,ge,1,0,"button",26)(19,_e,1,0,"button",27)(20,fe,1,0,"button",28),r()()()),s&2){let t=e.$implicit,o=e.editing;c("pEditableRow",t),u(2),b(t.id),u(6),b(t.sexo),u(2),b(t.fechaNacimiento),u(2),T("",t.usuario==null?null:t.usuario.nombre," ",t.usuario==null?null:t.usuario.apellido,""),u(2),b(t.historiaClinica.id),u(3),c("ngIf",!o),u(),c("ngIf",o),u(),c("ngIf",o),u(),c("ngIf",!o)}}var y=class s{constructor(e,t,o,a,n){this.aseguradoService=e;this.usuarioService=t;this.messageService=o;this.bitacoraService=a;this.authService=n}asegurados=[];usuariosDisponibles=[];nuevoAsegurado={tipoSangre:"",sexo:"",fechaNacimiento:"",usuario:{id:0,ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0,rol:void 0},historiaClinica:{id:0}};editedAsegurados={};sortField="id";sortOrder=1;ngOnInit(){this.getAsegurados(),this.getUsuariosDisponibles()}getAsegurados(){this.aseguradoService.getAsegurados().subscribe(e=>this.asegurados=e,e=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los asegurados"}))}registrarBitacora(e,t){this.bitacoraService.getUserIP().subscribe({next:o=>{let a=new Date,n=`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")}`,x=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`,w={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:n,hora:x,ip:o.ip,accion:e,detalle:t};this.bitacoraService.createBitacora(w).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:de=>console.error("Error al registrar en bit\xE1cora",de)})},error:o=>console.error("Error al obtener IP",o)})}getUsuariosDisponibles(){this.usuarioService.getUsuariosSinAseguradoByRol(2).subscribe(e=>this.usuariosDisponibles=e,e=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los usuarios disponibles"}))}addAsegurado(){console.log("Iniciando el proceso de creaci\xF3n de asegurado..."),this.aseguradoService.createAsegurado(this.nuevoAsegurado).subscribe(e=>{console.log("Asegurado creado en el backend, datos recibidos:",e),e.id!==void 0?this.aseguradoService.getAseguradoById(e.id).subscribe(t=>{console.log("Datos completos del asegurado recibidos:",t),this.getAsegurados(),this.asegurados.push(t),this.messageService.add({severity:"success",summary:"A\xF1adido",detail:"Asegurado a\xF1adido correctamente"});let o=`Asegurado creado: ${t.usuario?.correo}`;console.log("Detalle para bit\xE1cora:",o),this.registrarBitacora("A\xF1adir asegurado",o),this.resetNuevoAsegurado(),this.getUsuariosDisponibles()}):console.error("Error: ID del asegurado no definido")},e=>{console.error("Error al crear el asegurado en el backend:",e),this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo a\xF1adir el asegurado"})})}resetNuevoAsegurado(){this.nuevoAsegurado={tipoSangre:"",sexo:"",fechaNacimiento:"",usuario:{id:0,ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0,rol:void 0},historiaClinica:{id:0}}}deleteAsegurado(e){let t=this.asegurados.find(o=>o.id===e);if(!t){this.messageService.add({severity:"error",summary:"Error",detail:"Asegurado no encontrado"});return}this.aseguradoService.deleteAsegurado(e).subscribe(()=>{this.asegurados=this.asegurados.filter(o=>o.id!==e),this.messageService.add({severity:"success",summary:"Eliminado",detail:"Asegurado eliminado correctamente"}),this.registrarBitacora("Eliminar asegurado",`Asegurado eliminado: ${t?.usuario?.correo}`),this.getUsuariosDisponibles()},o=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el asegurado"}))}onRowEditInit(e){this.editedAsegurados[e.id]=E({},e),this.messageService.add({severity:"info",summary:"Edici\xF3n",detail:"Editando tipo de sangre"})}onRowEditSave(e){this.aseguradoService.updateAsegurado(e).subscribe(()=>{delete this.editedAsegurados[e.id],this.messageService.add({severity:"success",summary:"Guardado",detail:"Tipo de sangre actualizado"}),this.registrarBitacora("Modificar asegurado",`Asegurado modificado: ${e.usuario?.correo}`)})}onRowEditCancel(e,t){this.asegurados[t]=this.editedAsegurados[e.id]||e,delete this.editedAsegurados[e.id],this.messageService.add({severity:"info",summary:"Cancelado",detail:"Edici\xF3n cancelada"})}static \u0275fac=function(t){return new(t||s)(g(se),g(ae),g(C),g(N),g(D))};static \u0275cmp=M({type:s,selectors:[["app-asegurado"]],standalone:!0,features:[k([C]),P],decls:26,vars:10,consts:[[1,"add-asegurado-form"],[1,"form-field"],["for","tipoSangre"],["id","tipoSangre","pInputText","","placeholder","Ingrese el tipo de sangre",1,"input-field",3,"ngModelChange","ngModel"],["for","sexo"],["id","sexo","pInputText","","placeholder","Ingrese el sexo","maxlength","1",1,"input-field",3,"ngModelChange","ngModel"],["for","fechaNacimiento"],["dateFormat","yy-mm-dd",1,"input-calendar",3,"ngModelChange","ngModel"],["for","usuario"],["id","usuario","optionLabel","correo","optionValue","id","placeholder","Seleccione un usuario",1,"input-dropdown",3,"ngModelChange","options","ngModel"],[1,"form-field","button-container"],["pButton","","label","A\xF1adir Asegurado",1,"p-button-success",3,"click"],[1,"asegurado-list-container",2,"margin-top","2rem"],["dataKey","id","editMode","row",3,"value","tableStyle","sortField","sortOrder"],["pTemplate","header"],["pTemplate","body"],[2,"width","10%"],[2,"width","15%"],[2,"width","20%"],[2,"width","30%"],[2,"width","5%"],[3,"pEditableRow"],["pTemplate","output"],["pTemplate","input"],[1,"flex","align-items-center","justify-content-center","gap-2"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil","class","p-button-rounded",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded p-button-success",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded p-button-danger",3,"click",4,"ngIf"],["pButton","","icon","pi pi-trash","class","p-button-rounded p-button-danger",3,"click",4,"ngIf"],["pInputText","",1,"input-field",3,"ngModelChange","ngModel"],["pButton","","pRipple","","type","button","pInitEditableRow","","icon","pi pi-pencil",1,"p-button-rounded",3,"click"],["pButton","","pRipple","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded","p-button-success",3,"click"],["pButton","","pRipple","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded","p-button-danger",3,"click"],["pButton","","icon","pi pi-trash",1,"p-button-rounded","p-button-danger",3,"click"]],template:function(t,o){t&1&&(I(0,"p-toast"),i(1,"div",0)(2,"h3"),d(3,"A\xF1adir Asegurado"),r(),i(4,"div",1)(5,"label",2),d(6,"Tipo de Sangre"),r(),i(7,"input",3),v("ngModelChange",function(n){return S(o.nuevoAsegurado.tipoSangre,n)||(o.nuevoAsegurado.tipoSangre=n),n}),r()(),i(8,"div",1)(9,"label",4),d(10,"Sexo"),r(),i(11,"input",5),v("ngModelChange",function(n){return S(o.nuevoAsegurado.sexo,n)||(o.nuevoAsegurado.sexo=n),n}),r()(),i(12,"div",1)(13,"label",6),d(14,"Fecha de Nacimiento"),r(),i(15,"p-calendar",7),v("ngModelChange",function(n){return S(o.nuevoAsegurado.fechaNacimiento,n)||(o.nuevoAsegurado.fechaNacimiento=n),n}),r()(),i(16,"div",1)(17,"label",8),d(18,"Usuario"),r(),i(19,"p-dropdown",9),v("ngModelChange",function(n){return S(o.nuevoAsegurado.usuario.id,n)||(o.nuevoAsegurado.usuario.id=n),n}),r()(),i(20,"div",10)(21,"button",11),f("click",function(){return o.addAsegurado()}),r()()(),i(22,"div",12)(23,"p-table",13),A(24,le,15,0,"ng-template",14)(25,be,21,11,"ng-template",15),r()()),t&2&&(u(7),h("ngModel",o.nuevoAsegurado.tipoSangre),u(4),h("ngModel",o.nuevoAsegurado.sexo),u(4),h("ngModel",o.nuevoAsegurado.fechaNacimiento),u(4),c("options",o.usuariosDisponibles),h("ngModel",o.nuevoAsegurado.usuario.id),u(4),c("value",o.asegurados)("tableStyle",B(9,ue))("sortField",o.sortField)("sortOrder",o.sortOrder))},dependencies:[O,R,j,V,F,U,W,ie,Q,L,oe,X,Z,ee,te,ne,re,J,q,Y,K,H,G,z,$],styles:[".asegurado-list-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;overflow-x:auto}.add-asegurado-form[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem}.add-asegurado-form[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}.input-field[_ngcontent-%COMP%], .input-dropdown[_ngcontent-%COMP%], .input-calendar[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a}.input-dropdown[_ngcontent-%COMP%]:focus, .input-field[_ngcontent-%COMP%]:focus, .input-calendar[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.button-container[_ngcontent-%COMP%]{grid-column:1 / -1;display:flex;justify-content:center}.p-button-success[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important;width:40%;font-size:1rem;border-radius:8px;padding:.75rem 0;border:none!important;font-weight:700;transition:background-color .3s ease}.p-button-rounded[_ngcontent-%COMP%]{border-radius:50%!important}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}.p-button-success[_ngcontent-%COMP%]{background-color:#43a047!important;color:#fff!important}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}"]})};export{y as default};
