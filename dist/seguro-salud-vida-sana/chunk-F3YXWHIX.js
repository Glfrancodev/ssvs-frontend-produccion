import{a as k}from"./chunk-OUDKWMO5.js";import{a as q}from"./chunk-UMRBCVWM.js";import{a as V,b as z}from"./chunk-7ZVYFVUR.js";import{a as K,b as Y}from"./chunk-434S2MCI.js";import{B as H,d as l,f as F,k as W,l as $,n as j,s as R,t as L,u as G}from"./chunk-WB7R4CTM.js";import{b as T,d as A,e as U,j as N}from"./chunk-TCU2USIY.js";import"./chunk-4YRY4IP2.js";import{a as B}from"./chunk-B77IM2LF.js";import{o as D}from"./chunk-OAPWJZOF.js";import"./chunk-4YUBQKU5.js";import{Ab as f,Bb as b,Cb as M,Db as O,Eb as E,Fb as I,Ja as s,Ka as m,W as v,Xa as C,_a as u,da as S,db as i,ea as _,eb as r,fb as x,jb as w,mb as p,nb as y,wb as d,xb as g,zb as P}from"./chunk-VM3UWR7T.js";import"./chunk-ODN5LVDJ.js";var Z=()=>({"min-width":"50rem","max-width":"100%"});function ee(c,o){c&1&&(i(0,"tr")(1,"th",11),d(2,"ID"),r(),i(3,"th",11),d(4,"Item"),r(),i(5,"th",12),d(6,"Nombre Completo"),r(),i(7,"th",11),d(8,"Acci\xF3n"),r()())}function te(c,o){if(c&1){let t=w();i(0,"tr")(1,"td"),d(2),r(),i(3,"td"),d(4),r(),i(5,"td"),d(6),r(),i(7,"td")(8,"button",13),p("click",function(){let n=S(t).$implicit,a=y();return _(a.deleteMedico(n.id))}),r()()()}if(c&2){let t=o.$implicit;s(2),g(t.id),s(2),g(t.item),s(2),P("",t.usuario==null?null:t.usuario.nombre," ",t.usuario==null?null:t.usuario.apellido,"")}}var h=class c{constructor(o,t,e,n,a){this.medicoService=o;this.usuarioService=t;this.messageService=e;this.authService=n;this.bitacoraService=a}medicos=[];usuariosDisponibles=[];nuevoMedico={item:"",usuario:{id:0,ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0,rol:void 0}};ngOnInit(){this.getMedicos(),this.getUsuariosDisponibles()}getMedicos(){this.medicoService.getMedicos().subscribe(o=>this.medicos=o,o=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los m\xE9dicos"}))}getUsuariosDisponibles(){this.usuarioService.getUsuariosSinMedicoByRol(3).subscribe(o=>this.usuariosDisponibles=o,o=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los usuarios disponibles"}))}addMedico(){this.medicoService.createMedico(this.nuevoMedico).subscribe(o=>{o.id!==void 0?this.medicoService.getMedicoById(o.id).subscribe(t=>{this.getMedicos(),this.medicos.push(t),this.messageService.add({severity:"success",summary:"A\xF1adido",detail:"M\xE9dico a\xF1adido correctamente"});let e=t.usuario?.correo;this.registrarBitacora("A\xF1adir m\xE9dico",`M\xE9dico creado: ${e}`),this.resetNuevoMedico(),this.getUsuariosDisponibles()}):console.error("Error: ID del m\xE9dico creado es undefined")},o=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo a\xF1adir el m\xE9dico"}))}deleteMedico(o){let t=this.medicos.find(e=>e.id===o);this.medicoService.deleteMedico(o).subscribe(()=>{if(this.medicos=this.medicos.filter(e=>e.id!==o),this.messageService.add({severity:"success",summary:"Eliminado",detail:"M\xE9dico eliminado correctamente"}),t){let e=t.usuario?.correo;this.registrarBitacora("Eliminar m\xE9dico",`M\xE9dico eliminado: ${e}`)}this.getUsuariosDisponibles()},e=>this.messageService.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el m\xE9dico"}))}resetNuevoMedico(){this.nuevoMedico={item:"",usuario:{id:void 0,ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0,rol:void 0}}}registrarBitacora(o,t){this.bitacoraService.getUserIP().subscribe({next:e=>{let n=new Date,a=`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`,J=`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}:${n.getSeconds().toString().padStart(2,"0")}`,Q={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:a,hora:J,ip:e.ip,accion:o,detalle:t};this.bitacoraService.createBitacora(Q).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:X=>console.error("Error al registrar en bit\xE1cora",X)})},error:e=>console.error("Error al obtener IP",e)})}static \u0275fac=function(t){return new(t||c)(m(k),m(q),m(l),m(D),m(B))};static \u0275cmp=v({type:c,selectors:[["app-medico"]],standalone:!0,features:[O([l]),E],decls:17,vars:6,consts:[[1,"add-medico-form"],[1,"form-field"],["for","item"],["id","item","pInputText","","placeholder","Ingrese el item",1,"input-field",3,"ngModelChange","ngModel"],["for","usuario"],["id","usuario","optionLabel","correo","optionValue","id","placeholder","Seleccione un usuario",1,"p-dropdown",3,"ngModelChange","options","ngModel"],["pButton","","label","A\xF1adir M\xE9dico","icon","pi pi-plus",1,"p-button-success",3,"click"],[1,"medico-list-container",2,"margin-top","2rem"],["dataKey","id",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"width","20%"],[2,"width","40%"],["pButton","","icon","pi pi-trash",1,"p-button-rounded","p-button-danger",3,"click"]],template:function(t,e){t&1&&(x(0,"p-toast"),i(1,"div",0)(2,"h3"),d(3,"A\xF1adir M\xE9dico"),r(),i(4,"div",1)(5,"label",2),d(6,"Item"),r(),i(7,"input",3),M("ngModelChange",function(a){return b(e.nuevoMedico.item,a)||(e.nuevoMedico.item=a),a}),r()(),i(8,"div",1)(9,"label",4),d(10,"Usuario"),r(),i(11,"p-dropdown",5),M("ngModelChange",function(a){return b(e.nuevoMedico.usuario.id,a)||(e.nuevoMedico.usuario.id=a),a}),r()(),i(12,"button",6),p("click",function(){return e.addMedico()}),r()(),i(13,"div",7)(14,"p-table",8),C(15,ee,9,0,"ng-template",9)(16,te,9,4,"ng-template",10),r()()),t&2&&(s(7),f("ngModel",e.nuevoMedico.item),s(4),u("options",e.usuariosDisponibles),f("ngModel",e.nuevoMedico.usuario.id),s(3),u("value",e.medicos)("tableStyle",I(5,Z)))},dependencies:[Y,K,F,L,R,H,G,N,T,A,U,j,$,W,z,V],styles:[".medico-list-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;overflow-x:auto}.add-medico-form[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:100%;margin:auto}.add-medico-form[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}.input-field[_ngcontent-%COMP%], .p-dropdown[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a;transition:border-color .3s ease}.input-field[_ngcontent-%COMP%]:focus, .p-dropdown[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.p-button-success[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff!important;width:100%;max-width:150px;font-size:1rem;border-radius:8px;padding:.75rem;border:none!important;font-weight:700;transition:background-color .3s ease;margin:auto}.p-button-success[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:auto;border-radius:8px;overflow:hidden;box-shadow:0 4px 8px #0000001a;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:center;vertical-align:middle}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}"]})};export{h as default};
