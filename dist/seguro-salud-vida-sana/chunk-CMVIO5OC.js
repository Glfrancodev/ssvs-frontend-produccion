import{a as j}from"./chunk-O5GV366U.js";import{a as N}from"./chunk-WIG3ZVDE.js";import{a as B}from"./chunk-3GOBKWC2.js";import{a as z}from"./chunk-VAO66HGS.js";import{B as V}from"./chunk-F7MBEHRF.js";import{b as R,d as P,e as O,j as k}from"./chunk-24563CTF.js";import"./chunk-4YRY4IP2.js";import{h as T,j as W}from"./chunk-EALBQTKK.js";import{l as x,q as F}from"./chunk-5DWL5JJZ.js";import{$a as y,Ab as d,Cb as w,Eb as s,Fb as m,Gb as u,Ib as E,Na as r,Oa as p,_ as I,cb as M,ha as f,hb as n,ia as h,ib as a,nb as S,qb as v,ub as l}from"./chunk-3RWLLOHT.js";function D(g,c){if(g&1){let i=S();n(0,"div",12)(1,"h3"),d(2),a(),n(3,"div",2)(4,"label",13),d(5,"Medicamento"),a(),n(6,"input",14),u("ngModelChange",function(o){let t=f(i).$implicit;return m(t.medicamento,o)||(t.medicamento=o),h(o)}),a()(),n(7,"div",2)(8,"label",13),d(9,"Frecuencia"),a(),n(10,"input",14),u("ngModelChange",function(o){let t=f(i).$implicit;return m(t.frecuencia,o)||(t.frecuencia=o),h(o)}),a()(),n(11,"div",2)(12,"label",13),d(13,"Fecha de Inicio"),a(),n(14,"input",15),u("ngModelChange",function(o){let t=f(i).$implicit;return m(t.fechaInicio,o)||(t.fechaInicio=o),h(o)}),a()(),n(15,"div",2)(16,"label",13),d(17,"Fecha Final"),a(),n(18,"input",15),u("ngModelChange",function(o){let t=f(i).$implicit;return m(t.fechaFinal,o)||(t.fechaFinal=o),h(o)}),a()()()}if(g&2){let i=c.$implicit,e=c.index;r(2),w("Receta ",e+1,""),r(2),l("for","medicamento",e,""),r(2),l("id","medicamento",e,""),l("name","medicamento",e,""),s("ngModel",i.medicamento),r(2),l("for","frecuencia",e,""),r(2),l("id","frecuencia",e,""),l("name","frecuencia",e,""),s("ngModel",i.frecuencia),r(2),l("for","fechaInicio",e,""),r(2),l("id","fechaInicio",e,""),l("name","fechaInicio",e,""),s("ngModel",i.fechaInicio),r(2),l("for","fechaFinal",e,""),r(2),l("id","fechaFinal",e,""),l("name","fechaFinal",e,""),s("ngModel",i.fechaFinal)}}var _=class g{constructor(c,i,e,o,t,b){this.route=c;this.consultaService=i;this.tratamientoService=e;this.recetaService=o;this.cupoService=t;this.router=b}motivo="";diagnostico="";nota="";recetas=[];cupoId;historiaClinicaId;ngOnInit(){this.cupoId=Number(this.route.snapshot.paramMap.get("cupoId")),this.cupoId&&this.obtenerHistoriaClinicaIdDesdeCupo(this.cupoId)}obtenerHistoriaClinicaIdDesdeCupo(c){this.cupoService.getCupoById(c).subscribe(i=>{i&&i.asegurado&&i.asegurado.historiaClinica?(this.historiaClinicaId=i.asegurado.historiaClinica.id,console.log("Historia Cl\xEDnica ID obtenida:",this.historiaClinicaId)):console.error("No se encontr\xF3 la historia cl\xEDnica para el asegurado en el cupo especificado.")},i=>{console.error("Error al obtener el cupo:",i)})}agregarReceta(){this.recetas.push({medicamento:"",frecuencia:"",fechaInicio:"",fechaFinal:""})}guardarConsulta(){if(!this.cupoId||!this.historiaClinicaId){console.error("Faltan datos para guardar la consulta.");return}let c={fechaConsulta:new Date().toISOString().split("T")[0],motivoConsulta:this.motivo,diagnostico:this.diagnostico,nota:this.nota,cupo:{id:this.cupoId,numero:0,fechaReservado:"",hora:"",estado:"",horario:void 0,asegurado:void 0},historiaClinica:{id:this.historiaClinicaId}};this.consultaService.createConsulta(c).subscribe(i=>{if(console.log("Consulta guardada:",i),this.recetas.length>0){let e={fecha:i.fechaConsulta,consulta:{id:i.id,fechaConsulta:"",motivoConsulta:"",diagnostico:"",nota:"",cupo:void 0,historiaClinica:void 0}};this.tratamientoService.createTratamiento(e).subscribe(o=>{console.log("Tratamiento guardado:",o),this.recetas.forEach(t=>{let b={medicamento:t.medicamento,frecuencia:t.frecuencia,fechaInicio:t.fechaInicio,fechaFinal:t.fechaFinal,tratamiento:{id:o.id,fecha:""}};this.recetaService.createReceta(b).subscribe(C=>{console.log("Receta guardada:",C)},C=>{console.error("Error al guardar receta:",C)})}),this.actualizarEstadoCupo()},o=>{console.error("Error al guardar el tratamiento:",o)})}else this.actualizarEstadoCupo()},i=>{console.error("Error al guardar la consulta:",i)})}actualizarEstadoCupo(){this.cupoService.actualizarEstadoCupo(this.cupoId,"Terminado").subscribe(c=>{console.log('Estado del cupo actualizado a "Terminado":',c),this.router.navigate(["/dashboard"])},c=>{console.error("Error al actualizar el estado del cupo:",c)})}static \u0275fac=function(i){return new(i||g)(p(T),p(B),p(N),p(j),p(z),p(W))};static \u0275cmp=I({type:g,selectors:[["app-consulta"]],standalone:!0,features:[E],decls:22,vars:4,consts:[[1,"consulta-container"],[1,"form"],[1,"form-field"],["for","motivo",1,"label"],["id","motivo","name","motivo",1,"textarea",3,"ngModelChange","ngModel"],["for","diagnostico",1,"label"],["id","diagnostico","name","diagnostico",1,"textarea",3,"ngModelChange","ngModel"],["for","nota",1,"label"],["id","nota","name","nota",1,"textarea",3,"ngModelChange","ngModel"],["class","form receta-form",4,"ngFor","ngForOf"],[1,"button-container"],["type","button",1,"button",3,"click"],[1,"form","receta-form"],[1,"label",3,"for"],[1,"textarea",3,"ngModelChange","id","ngModel","name"],["type","date",1,"textarea",3,"ngModelChange","id","ngModel","name"]],template:function(i,e){i&1&&(n(0,"div",0)(1,"div",1)(2,"h3"),d(3,"Detalles de la Consulta"),a(),n(4,"div",2)(5,"label",3),d(6,"Motivo"),a(),n(7,"textarea",4),u("ngModelChange",function(t){return m(e.motivo,t)||(e.motivo=t),t}),a()(),n(8,"div",2)(9,"label",5),d(10,"Diagn\xF3stico"),a(),n(11,"textarea",6),u("ngModelChange",function(t){return m(e.diagnostico,t)||(e.diagnostico=t),t}),a()(),n(12,"div",2)(13,"label",7),d(14,"Nota"),a(),n(15,"textarea",8),u("ngModelChange",function(t){return m(e.nota,t)||(e.nota=t),t}),a()(),y(16,D,19,29,"div",9),n(17,"div",10)(18,"button",11),v("click",function(){return e.agregarReceta()}),d(19,"Agregar Receta"),a(),n(20,"button",11),v("click",function(){return e.guardarConsulta()}),d(21,"Guardar Consulta"),a()()()()),i&2&&(r(7),s("ngModel",e.motivo),r(4),s("ngModel",e.diagnostico),r(4),s("ngModel",e.nota),r(),M("ngForOf",e.recetas))},dependencies:[F,x,V,k,R,P,O],styles:[".consulta-container[_ngcontent-%COMP%]{max-width:100%;margin:auto;padding:1.5rem;background-color:#f9f9f9;border-radius:12px;box-shadow:0 4px 8px #0000001a}.consulta-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin-bottom:1rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:1rem}.label[_ngcontent-%COMP%]{font-weight:700;color:#333;margin-bottom:.25rem}.textarea[_ngcontent-%COMP%], .input-field[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:1.5rem}.button[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;border:none;padding:.75rem 1.5rem;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s}.button[_ngcontent-%COMP%]:hover{background-color:#388e3c}"]})};export{_ as default};
