import{a as z}from"./chunk-OUDKWMO5.js";import{a as ee,b as te}from"./chunk-7ZVYFVUR.js";import{a as pe,b as ue}from"./chunk-434S2MCI.js";import{A as de,B as le,d as S,f as Y,k as J,l as Q,m as X,n as Z,q as ie,s as oe,t as ne,u as re,w as ae,x as se,y as ce,z as me}from"./chunk-WB7R4CTM.js";import{b as N,d as G,e as q,j as K}from"./chunk-TCU2USIY.js";import"./chunk-4YRY4IP2.js";import{a as U}from"./chunk-B77IM2LF.js";import{a as j,b as L,o as x}from"./chunk-OAPWJZOF.js";import{m as H,q as W}from"./chunk-4YUBQKU5.js";import{Ab as h,Bb as P,Cb as A,Db as R,Eb as D,Fb as V,Ja as d,Ka as p,M as T,R as y,W as k,Xa as _,Zb as F,_a as l,da as u,db as n,ea as g,eb as r,fb as $,jb as b,mb as f,nb as m,wb as c,xb as w,yb as B,zb as C}from"./chunk-VM3UWR7T.js";import{a as O}from"./chunk-ODN5LVDJ.js";var M=class o{constructor(t,e){this.http=t;this.authService=e}apiUrl="https://ssvs-backend-produccion-production.up.railway.app/api/permiso-ausencia";getAuthHeaders(){return new j({"Content-Type":"application/json",Authorization:`Bearer ${this.authService.getToken()}`})}getPermisosAusencia(){return this.http.get(this.apiUrl,{headers:this.getAuthHeaders()})}getPermisoAusenciaById(t){return this.http.get(`${this.apiUrl}/${t}`,{headers:this.getAuthHeaders()})}createPermisoAusencia(t){return this.http.post(this.apiUrl,t,{headers:this.getAuthHeaders()})}updatePermisoAusencia(t){return this.http.put(`${this.apiUrl}/${t.id}`,t,{headers:this.getAuthHeaders()})}deletePermisoAusencia(t){return this.http.delete(`${this.apiUrl}/${t}`,{headers:this.getAuthHeaders()})}static \u0275fac=function(e){return new(e||o)(y(L),y(x))};static \u0275prov=T({token:o,factory:o.\u0275fac,providedIn:"root"})};var he=()=>({"min-width":"50rem","max-width":"100%"});function Pe(o,t){if(o&1&&c(0),o&2){let e=t.$implicit;C(" ",e.usuario==null?null:e.usuario.nombre," ",e.usuario==null?null:e.usuario.apellido," ")}}function Ae(o,t){if(o&1&&c(0),o&2){let e=t.$implicit;C(" ",e.usuario==null?null:e.usuario.nombre," ",e.usuario==null?null:e.usuario.apellido," ")}}function ve(o,t){o&1&&(n(0,"tr")(1,"th",16),c(2,"ID"),r(),n(3,"th",17),c(4,"Fecha Permiso"),r(),n(5,"th",18),c(6,"Descripci\xF3n"),r(),n(7,"th",17),c(8,"Estado"),r(),n(9,"th",17),c(10,"M\xE9dico"),r(),n(11,"th",19),c(12,"Acciones"),r()())}function we(o,t){if(o&1){let e=b();n(0,"p-dropdown",29),A("ngModelChange",function(s){u(e);let a=m(2).$implicit;return P(a.estado,s)||(a.estado=s),g(s)}),r()}if(o&2){let e=m(2).$implicit,i=m();l("options",i.estadoOptions),h("ngModel",e.estado)}}function Ce(o,t){if(o&1&&_(0,we,1,2,"p-dropdown",28),o&2){let e=m().$implicit;l("ngIf",e.estado==="Pendiente")}}function xe(o,t){if(o&1&&c(0),o&2){let e=m().$implicit;B(" ",e.estado," ")}}function Se(o,t){if(o&1){let e=b();n(0,"button",30),f("click",function(){u(e);let s=m().$implicit,a=m();return g(a.onRowEditInit(s))}),r()}}function Me(o,t){if(o&1){let e=b();n(0,"button",31),f("click",function(){u(e);let s=m().$implicit,a=m();return g(a.onRowEditSave(s))}),r()}}function Ee(o,t){if(o&1){let e=b();n(0,"button",32),f("click",function(){u(e);let s=m(),a=s.$implicit,v=s.rowIndex,E=m();return g(E.onRowEditCancel(a,v))}),r()}}function ye(o,t){if(o&1){let e=b();n(0,"button",33),f("click",function(){u(e);let s=m().$implicit,a=m();return g(a.deletePermisoAusencia(s.id))}),r()}}function Ie(o,t){if(o&1&&(n(0,"tr",20)(1,"td"),c(2),r(),n(3,"td"),c(4),r(),n(5,"td"),c(6),r(),n(7,"td")(8,"p-cellEditor"),_(9,Ce,1,1,"ng-template",21)(10,xe,1,1,"ng-template",22),r()(),n(11,"td"),c(12),r(),n(13,"td")(14,"div",23),_(15,Se,1,0,"button",24)(16,Me,1,0,"button",25)(17,Ee,1,0,"button",26)(18,ye,1,0,"button",27),r()()()),o&2){let e=t.$implicit,i=t.editing;l("pEditableRow",e),d(2),w(e.id),d(2),w(e.fechaPermiso),d(2),w(e.descripcion),d(6),C("",e.medico==null?null:e.medico.usuario.nombre," ",e.medico==null?null:e.medico.usuario.apellido,""),d(3),l("ngIf",e.estado==="Pendiente"&&!i),d(),l("ngIf",i),d(),l("ngIf",i),d(),l("ngIf",e.estado==="Pendiente"&&!i)}}var I=class o{constructor(t,e,i,s,a,v){this.permisoAusenciaService=t;this.medicoService=e;this.messageService=i;this.bitacoraService=s;this.authService=a;this.cdr=v}permisosAusencia=[];medicos=[];estadoOptions=[{label:"Pendiente",value:"Pendiente"},{label:"Aprobado",value:"Aprobado"},{label:"Denegado",value:"Denegado"}];editedPermisosAusencia={};newPermisoAusencia={fechaPermiso:"",descripcion:"",estado:"Pendiente",medico:{id:0,item:"",usuario:{ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0}}};ngOnInit(){this.getAllPermisosAusencia(),this.getAllMedicos()}getAllPermisosAusencia(){this.permisoAusenciaService.getPermisosAusencia().subscribe(t=>{this.permisosAusencia=t,this.sortPermisosAusencia()})}getAllMedicos(){this.medicoService.getMedicos().subscribe(t=>{this.medicos=t})}sortPermisosAusencia(){this.permisosAusencia.sort((t,e)=>(t.id||0)-(e.id||0))}addPermisoAusencia(){if(!this.newPermisoAusencia.fechaPermiso||!this.newPermisoAusencia.descripcion){this.messageService.add({severity:"warn",summary:"Campos Incompletos",detail:"Por favor, complete todos los campos requeridos"});return}this.permisoAusenciaService.createPermisoAusencia(this.newPermisoAusencia).subscribe(t=>{this.permisoAusenciaService.getPermisoAusenciaById(t.id).subscribe(e=>{this.getAllPermisosAusencia(),this.messageService.add({severity:"success",summary:"Permiso de Ausencia Agregado",detail:"Nuevo permiso de ausencia creado correctamente"});let i=`${e.medico?.usuario?.nombre} ${e.medico?.usuario?.apellido}`;this.registrarBitacora("A\xF1adir Permiso Ausencia",`A\xF1adir Permiso Ausencia para el ${e.fechaPermiso} de ${i}`),this.newPermisoAusencia={fechaPermiso:"",descripcion:"",estado:"Pendiente",medico:{id:0,item:"",usuario:{ci:"",correo:"",contrasena:"",nombre:"",apellido:"",estaActivo:!0}}}})})}onRowEditInit(t){this.editedPermisosAusencia[t.id]=O({},t)}onRowEditSave(t){this.permisoAusenciaService.updatePermisoAusencia(t).subscribe(()=>{delete this.editedPermisosAusencia[t.id],this.messageService.add({severity:"success",summary:"Estado Actualizado",detail:"El estado del permiso ha sido actualizado correctamente"}),this.getAllPermisosAusencia();let e=`${t.medico?.usuario?.nombre||"Desconocido"} ${t.medico?.usuario?.apellido||"Desconocido"}`;this.registrarBitacora("Modificar Permiso Ausencia",`Permiso para el ${t.fechaPermiso} de ${e} fue ${t.estado}`)})}onRowEditCancel(t,e){this.permisosAusencia[e]=this.editedPermisosAusencia[t.id]||t,delete this.editedPermisosAusencia[t.id]}deletePermisoAusencia(t){let e=this.permisosAusencia.find(i=>i.id===t);this.permisoAusenciaService.deletePermisoAusencia(t).subscribe(()=>{if(this.permisosAusencia=this.permisosAusencia.filter(i=>i.id!==t),this.messageService.add({severity:"success",summary:"Eliminado",detail:"Permiso de ausencia eliminado correctamente"}),e){let i=`${e.medico?.usuario?.nombre||"Desconocido"} ${e.medico?.usuario?.apellido||"Desconocido"}`;this.registrarBitacora("Eliminar Permiso Ausencia",`Permiso para el ${e.fechaPermiso} de ${i} eliminada`)}})}registrarBitacora(t,e){this.bitacoraService.getUserIP().subscribe({next:i=>{let s=new Date,a=`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")}`,v=`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}:${s.getSeconds().toString().padStart(2,"0")}`,E={correo:this.authService.getAuthenticatedUserEmail()||"",fecha:a,hora:v,ip:i.ip,accion:t,detalle:e};this.bitacoraService.createBitacora(E).subscribe({next:()=>console.log("Registro de bit\xE1cora exitoso"),error:ge=>console.error("Error al registrar en bit\xE1cora",ge)})},error:i=>console.error("Error al obtener IP",i)})}static \u0275fac=function(e){return new(e||o)(p(M),p(z),p(S),p(U),p(x),p(F))};static \u0275cmp=k({type:o,selectors:[["app-permiso-ausencia"]],standalone:!0,features:[R([S]),D],decls:23,vars:7,consts:[[1,"form-container","add-permiso-ausencia-form"],[2,"font-weight","bold"],[1,"form-field"],["for","fechaPermiso"],["id","fechaPermiso","type","date","pInputText","",1,"input-field",3,"ngModelChange","ngModel"],["for","descripcion"],["id","descripcion","type","text","pInputText","","placeholder","Ingrese Descripci\xF3n",1,"input-field",3,"ngModelChange","ngModel"],["for","medico"],["id","medico","optionLabel","nombreCompleto","optionValue","id","placeholder","Seleccione M\xE9dico",1,"input-dropdown",3,"ngModelChange","options","ngModel"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"form-field","center-content"],["label","A\xF1adir Permiso","icon","pi pi-plus","styleClass","p-button-raised p-button-success button-custom",3,"click"],["dataKey","id","editMode","row",3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"],[2,"width","10%"],[2,"width","15%"],[2,"width","30%"],[2,"width","20%"],[3,"pEditableRow"],["pTemplate","input"],["pTemplate","output"],[1,"action-buttons"],["pButton","","icon","pi pi-pencil","class","p-button-rounded p-button-text","pInitEditableRow","",3,"click",4,"ngIf"],["pButton","","icon","pi pi-check","class","p-button-rounded p-button-success","pSaveEditableRow","",3,"click",4,"ngIf"],["pButton","","icon","pi pi-times","class","p-button-rounded p-button-danger","pCancelEditableRow","",3,"click",4,"ngIf"],["pButton","","icon","pi pi-trash","class","p-button-rounded p-button-danger",3,"click",4,"ngIf"],["optionLabel","label","optionValue","value",3,"options","ngModel","ngModelChange",4,"ngIf"],["optionLabel","label","optionValue","value",3,"ngModelChange","options","ngModel"],["pButton","","icon","pi pi-pencil","pInitEditableRow","",1,"p-button-rounded","p-button-text",3,"click"],["pButton","","icon","pi pi-check","pSaveEditableRow","",1,"p-button-rounded","p-button-success",3,"click"],["pButton","","icon","pi pi-times","pCancelEditableRow","",1,"p-button-rounded","p-button-danger",3,"click"],["pButton","","icon","pi pi-trash",1,"p-button-rounded","p-button-danger",3,"click"]],template:function(e,i){e&1&&($(0,"p-toast"),n(1,"div",0)(2,"h3",1),c(3,"A\xF1adir Nuevo Permiso de Ausencia"),r(),n(4,"div",2)(5,"label",3),c(6,"Fecha del Permiso"),r(),n(7,"input",4),A("ngModelChange",function(a){return P(i.newPermisoAusencia.fechaPermiso,a)||(i.newPermisoAusencia.fechaPermiso=a),a}),r()(),n(8,"div",2)(9,"label",5),c(10,"Descripci\xF3n"),r(),n(11,"input",6),A("ngModelChange",function(a){return P(i.newPermisoAusencia.descripcion,a)||(i.newPermisoAusencia.descripcion=a),a}),r()(),n(12,"div",2)(13,"label",7),c(14,"M\xE9dico"),r(),n(15,"p-dropdown",8),A("ngModelChange",function(a){return P(i.newPermisoAusencia.medico.id,a)||(i.newPermisoAusencia.medico.id=a),a}),_(16,Pe,1,2,"ng-template",9)(17,Ae,1,2,"ng-template",10),r()(),n(18,"div",11)(19,"p-button",12),f("click",function(){return i.addPermisoAusencia()}),r()()(),n(20,"p-table",13),_(21,ve,13,0,"ng-template",14)(22,Ie,19,10,"ng-template",15),r()),e&2&&(d(7),h("ngModel",i.newPermisoAusencia.fechaPermiso),d(4),h("ngModel",i.newPermisoAusencia.descripcion),d(4),l("options",i.medicos),h("ngModel",i.newPermisoAusencia.medico.id),d(5),l("value",i.permisosAusencia)("tableStyle",V(6,he)))},dependencies:[ue,pe,Y,le,re,de,ae,se,ce,me,W,H,K,N,G,q,Z,Q,X,J,te,ee,ne,oe,ie],styles:[".form-container[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #dcdcdc;border-radius:12px;background-color:#f9f9f9;box-shadow:0 4px 8px #0000001a;margin-bottom:1.5rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:100%;margin:auto}.form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column:1 / -1;font-size:1.8rem;font-weight:700;color:#3f51b5;text-align:center;margin:0;margin-bottom:1rem;border-bottom:2px solid #ddd;padding-bottom:.5rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.25rem}.input-field[_ngcontent-%COMP%], .input-dropdown[_ngcontent-%COMP%]{width:100%;padding:.5rem;border-radius:6px;border:1px solid #ddd;background-color:#fff;font-size:.95rem;box-shadow:inset 0 1px 3px #0000001a}.input-dropdown[_ngcontent-%COMP%]:focus, .input-field[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 4px #3f51b54d}.p-button-success[_ngcontent-%COMP%]{width:100%;max-width:150px;font-size:1rem;border-radius:8px;padding:.75rem;margin:auto}.p-table[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:auto;border-radius:8px;overflow:hidden;box-shadow:0 4px 8px #0000001a;font-size:.95rem}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;font-weight:700;text-align:center;padding:12px}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .3s}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f7f7f7}.p-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.p-button-danger[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:50%;color:#d32f2f!important}.p-button-danger[_ngcontent-%COMP%]:hover{background-color:#d32f2f!important;color:#fff!important}.p-button-rounded.p-button-success[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;color:#43a047!important}.p-button-rounded.p-button-text[_ngcontent-%COMP%]{color:#007bff!important}"]})};export{I as default};
